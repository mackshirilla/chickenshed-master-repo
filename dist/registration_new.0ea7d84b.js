!function(e,t,o,n,i){var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r="function"==typeof s[n]&&s[n],l=r.cache||{},a="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function d(t,o){if(!l[t]){if(!e[t]){var i="function"==typeof s[n]&&s[n];if(!o&&i)return i(t,!0);if(r)return r(t,!0);if(a&&"string"==typeof t)return a(t);var c=Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(o){var n=e[t][1][o];return null!=n?n:o},p.cache={};var u=l[t]=new d.Module(t);e[t][0].call(u.exports,p,u,u.exports,this)}return l[t].exports;function p(e){var t=p.resolve(e);return!1===t?{}:d(t)}}d.isParcelRequire=!0,d.Module=function(e){this.id=e,this.bundle=d,this.exports={}},d.modules=e,d.cache=l,d.parent=r,d.register=function(t,o){e[t]=[function(e,t){t.exports=o},{}]},Object.defineProperty(d,"root",{get:function(){return s[n]}}),s[n]=d;for(var c=0;c<t.length;c++)d(t[c])}({nOUIZ:[function(e,t,o){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(o),n.export(o,"newProgramRegistration",()=>g);var i=e("../../api/startRegistration"),s=e("./components/dynamicRegistrationTable"),r=e("./components/checkoutLineItems"),l=e("./components/financialAid"),a=e("./state/registrationState"),d=e("./components/pendingStudentsAlert"),c=e("./components/checkoutSubmission"),u=e("./components/loadRegistrationUi"),p=e("@xatom/core"),m=e("./components/actionRequiredDialog");async function g(){console.log("new registration");try{let t=await (0,i.startRegistration)({});console.log("Registration started:",t),(0,a.saveState)({apiData:t}),(0,s.initDynamicRegistrationTable)(t,{tableBodySelector:"#subscription_items_list",emptyStateSelector:"#subscription_empty",templateRowSelector:"#subscription_item",addButtonSelector:"#subscription_items_table tfoot #add_subscription_item",isAddOn:!1,fields:{program:{textSelector:"#item_program_name",selectSelector:"#program-select-1"},workshop:{textSelector:"#item_workshop_name",selectSelector:"#workshop-select-1"},session:{textSelector:"#item_session_name",selectSelector:"#session-select-1"},student:{textSelector:"#item_student_name",selectSelector:"#student-select-1"}}});let o=(0,a.loadState)();o.registrationItems&&o.registrationItems.length>0&&(0,u.loadRegistrationUI)();let n=document.getElementById("subscription_type");n&&o.subscriptionType&&(n.value=o.subscriptionType),(0,r.updateCheckoutLineItems)(t),(0,d.updatePendingStudentsAlert)(t),(0,m.showActionRequiredDialogIfNoStudentProfiles)(t);let l=document.querySelector(".success_trigger");function e(){let e=document.querySelectorAll("#subscription_items_list tr.confirmed"),t=document.getElementById("submit_registration_checkout");0===e.length?t.disabled=!0:t.disabled=!1}l&&l.click(),e(),document.addEventListener("registrationChanged",()=>{(0,r.updateCheckoutLineItems)(t),(0,d.updatePendingStudentsAlert)(t),e()}),n&&n.addEventListener("change",()=>{(0,a.saveState)({subscriptionType:n.value}),(0,r.updateCheckoutLineItems)(t)});let g=new p.WFComponent("#submit_registration_checkout");g.on("click",async e=>{e.preventDefault();let t=g.getElement();if(t.disabled)return;t.disabled=!0;let o=document.getElementById("submit_registration_checkout_animation");o&&(o.style.display="block");try{await (0,c.submitCheckout)()}catch(e){console.error(e)}finally{o&&(o.style.display="none"),t.disabled=!1}})}catch(e){console.error("Error starting registration:",e)}(0,l.initializeFinancialAid)()}},{"../../api/startRegistration":"56OKH","./components/dynamicRegistrationTable":"eXZgF","./components/checkoutLineItems":"4OVcI","./components/financialAid":"82j3J","./state/registrationState":"7PLg3","./components/pendingStudentsAlert":"fBuhT","./components/checkoutSubmission":"aW9bX","./components/loadRegistrationUi":"j6atX","@xatom/core":"65YBq","./components/actionRequiredDialog":"6YvTl","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"56OKH":[function(e,t,o){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(o),n.export(o,"startRegistration",()=>s);var i=e("./apiConfig");async function s(e){try{let t=await (0,i.apiClient).post("/registration/start_registration",e).fetch();return t.has_active_subscription&&window.location.assign("/dashboard/registration/manage-subscription"),t}catch(e){throw console.error("Error starting registration:",e),e}}},{"./apiConfig":"dUmIV","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],eXZgF:[function(e,t,o){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(o),n.export(o,"initDynamicRegistrationTable",()=>r),n.export(o,"attachRowEventListeners",()=>d),n.export(o,"populateProgramOptions",()=>l);var i=e("@xatom/core"),s=e("../state/registrationState");function r(e,t){let o=new i.WFComponent(t.tableBodySelector),n=new i.WFComponent(t.emptyStateSelector),s=new i.WFComponent(t.addButtonSelector),r=document.querySelector(t.templateRowSelector);if(!r){console.error("Template row not found with selector:",t.templateRowSelector);return}r.style.display="none",s.on("click",()=>{n.getElement().style.display="none";let s=r.cloneNode(!0);s.removeAttribute("id"),s.style.display="table-row";let a=new i.WFComponent(s);[{field:"program",enable:!0},{field:"workshop",enable:!1},{field:"session",enable:!1},{field:"student",enable:!1}].forEach(e=>{let o=a.getChildAsComponent(t.fields[e.field].textSelector),n=a.getChildAsComponent(t.fields[e.field].selectSelector);o.getElement().style.display="none",n.getElement().style.display="block",n.getElement().disabled=!e.enable}),a.getChildAsComponent(".add_registration_button").getElement().style.display="block",a.removeCssClass("confirmed"),o.appendChild(a),l(a,e,t),d(a,e,t)})}function l(e,t,o){let n=e.getChildAsComponent(o.fields.program.selectSelector);n.getElement().disabled=!1;let i=new Map;t.sessions.forEach(e=>{e.program.Add_On_Program===o.isAddOn&&i.set(e.program.id,e.program.name)});let s='<option value="">Select Program</option>';i.forEach((e,t)=>{s+=`<option value="${t}">${e}</option>`}),n.setHTML(s)}function a(e,t,o,n,i){let s=e.getChildAsComponent(i.fields.session.selectSelector);s.getElement().disabled=!1;let r=t.sessions.filter(e=>e.program.id.toString()===o);n&&(r=r.filter(e=>e.workshop&&e.workshop.id.toString()===n));let l='<option value="">Select Session</option>';r.forEach(e=>{l+=`<option value="${e.id}">${e.Name} (${e.Time_block})</option>`}),s.setHTML(l)}function d(e,t,o){let n=e.getChildAsComponent(o.fields.program.selectSelector);n.on("change",()=>{let i=n.getElement().value;e.getElement().setAttribute("data-program-id",i),function(e,t,o,n){let i=e.getChildAsComponent(n.fields.workshop.selectSelector),s=t.sessions.filter(e=>e.program.id.toString()===o&&e.workshop);if(s.length>0){i.getElement().disabled=!1;let t='<option value="">Select Workshop</option>',o=new Map;s.forEach(e=>{e.workshop&&o.set(e.workshop.id,e.workshop.Name)}),o.forEach((e,o)=>{t+=`<option value="${o}">${e}</option>`}),i.setHTML(t),i.getElement().style.display="block",e.getChildAsComponent(n.fields.workshop.textSelector).getElement().style.display="none"}else{i.getElement().disabled=!0,i.getElement().style.display="none";let s=e.getChildAsComponent(n.fields.workshop.textSelector);s.setText(" - "),s.getElement().style.display="block",a(e,t,o,null,n)}}(e,t,i,o),e.getChildAsComponent(o.fields.session.selectSelector).getElement().disabled=!1});let i=e.getChildAsComponent(o.fields.workshop.selectSelector);i.on("change",()=>{let n=i.getElement().value;e.getElement().setAttribute("data-workshop-id",n);let s=e.getElement().getAttribute("data-program-id")||"";a(e,t,s,n,o)});let r=e.getChildAsComponent(o.fields.session.selectSelector);r.on("change",()=>{let n=r.getElement().value;e.getElement().setAttribute("data-session-id",n),e.getChildAsComponent(o.fields.student.selectSelector).getElement().disabled=!1,function(e,t,o){let n=e.getChildAsComponent(o.fields.student.selectSelector);n.getElement().disabled=!1;let i='<option value="">Select Student</option>',s=e.getElement().getAttribute("data-session-id"),r=document.querySelector(o.tableBodySelector),l=[];r&&s&&Array.from(r.querySelectorAll("tr.confirmed")).forEach(e=>{if(e.getAttribute("data-session-id")===s){let t=e.getAttribute("data-student-id");t&&l.push(t)}}),t.student_profiles.forEach(e=>{l.includes(e.id.toString())||(i+=`<option value="${e.id}">${e.full_name}</option>`)}),n.setHTML(i)}(e,t,o)});let l=e.getChildAsComponent(o.fields.student.selectSelector);l.on("change",()=>{let t=l.getElement();e.getElement().setAttribute("data-student-id",t.value)});let d=e.getChildAsComponent(".add_registration_button");d.on("click",()=>{let t=e.getChildAsComponent(o.fields.program.selectSelector).getElement(),n=e.getChildAsComponent(o.fields.session.selectSelector).getElement(),i=e.getChildAsComponent(o.fields.student.selectSelector).getElement();if(!t.value||!n.value||!i.value){console.warn("Please select a Program, Session, and Student.");return}let r=document.querySelector(o.tableBodySelector),l=e.getElement().getAttribute("data-session-id");if(r&&l&&Array.from(r.querySelectorAll("tr.confirmed")).some(e=>e.getAttribute("data-session-id")===l&&e.getAttribute("data-student-id")===i.value)){console.warn("This student is already registered for the selected session.");return}e.getElement().setAttribute("data-student-id",i.value);let a=e.getChildAsComponent(o.fields.program.textSelector);a.setText(t.options[t.selectedIndex].text);let c=e.getChildAsComponent(o.fields.workshop.selectSelector).getElement(),u=c.disabled?" - ":c.options[c.selectedIndex].text,p=e.getChildAsComponent(o.fields.workshop.textSelector);p.setText(u);let m=e.getChildAsComponent(o.fields.session.textSelector);m.setText(n.options[n.selectedIndex].text);let g=e.getChildAsComponent(o.fields.student.textSelector);g.setText(i.options[i.selectedIndex].text);let f=t=>{let o=e.getChildAsComponent(t).getElement().parentElement;o&&(o.style.display="none")};f(o.fields.program.selectSelector),f(o.fields.workshop.selectSelector),f(o.fields.session.selectSelector),f(o.fields.student.selectSelector),d.getElement().style.display="none",a.getElement().style.display="block",p.getElement().style.display="block",m.getElement().style.display="block",g.getElement().style.display="block",e.addCssClass("confirmed");let h=(0,s.loadState)().registrationItems||[],y={program_id:e.getAttribute("data-program-id"),session_id:e.getAttribute("data-session-id"),student_id:e.getAttribute("data-student-id"),program_name:t.options[t.selectedIndex].text,workshop_name:p.getElement().textContent||"",session_name:m.getElement().textContent||"",student_name:g.getElement().textContent||""};(0,s.saveState)({registrationItems:[...h,y]}),document.dispatchEvent(new CustomEvent("registrationChanged"))}),e.getChildAsComponent(".remove_registration_button").on("click",()=>{e.remove();let t=document.querySelector(o.tableBodySelector);if(t){let e=o.templateRowSelector.startsWith("#")?o.templateRowSelector.slice(1):o.templateRowSelector,n=o.emptyStateSelector.startsWith("#")?o.emptyStateSelector.slice(1):o.emptyStateSelector;if(0===Array.from(t.querySelectorAll("tr")).filter(t=>t.id!==e&&t.id!==n).length){let e=document.querySelector(o.emptyStateSelector);e&&(e.style.display="table-row")}}let n=((0,s.loadState)().registrationItems||[]).filter(t=>!(t.session_id===e.getAttribute("data-session-id")&&t.student_id===e.getAttribute("data-student-id")));(0,s.saveState)({registrationItems:n}),document.dispatchEvent(new CustomEvent("registrationChanged"))})}},{"@xatom/core":"65YBq","../state/registrationState":"7PLg3","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"7PLg3":[function(e,t,o){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(o),n.export(o,"loadState",()=>r),n.export(o,"saveState",()=>l),n.export(o,"resetRegistrationState",()=>a);let i="registrationState",s=function(){try{let e=localStorage.getItem(i);return e?JSON.parse(e):null}catch(e){return console.error("Error loading state from storage:",e),null}}()||{fin_aid_requested:!1,selected_discount:void 0,financialAidData:void 0,subscriptionType:"year",apiData:void 0,originalSubscriptionTotal:0,registrationItems:[]};function r(){return s}function l(e){d(s={...s,...e})}function a(){d(s={fin_aid_requested:!1,selected_discount:void 0,financialAidData:void 0,subscriptionType:"year",apiData:void 0,originalSubscriptionTotal:0,registrationItems:[]})}function d(e){try{localStorage.setItem(i,JSON.stringify(e))}catch(e){console.error("Error saving state to storage:",e)}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"4OVcI":[function(e,t,o){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(o),n.export(o,"updateCheckoutLineItems",()=>d);var i=e("@xatom/core"),s=e("../state/registrationState"),r=e("./updateTotalAmount");function l(e,t){let o=e.find(e=>e.id.toString()===t);return console.log(`[DEBUG] getSessionById: Looking for session id ${t}:`,o),o}function a(e){let t=new Map;e.forEach(e=>{let o=e.productName;if(t.has(o)){let n=t.get(o);n.quantity+=e.quantity,n.total+=e.total,t.set(o,n)}else t.set(o,{...e})});let o=Array.from(t.values());return console.log("[DEBUG] groupLineItems: Final grouped items:",o),o}function d(e){console.log("[DEBUG] updateCheckoutLineItems: Running updateCheckoutLineItems...");let t=document.getElementById("subscription_type");if(!t){console.warn("[DEBUG] updateCheckoutLineItems: Subscription type select not found.");return}let o=t.value;console.log("[DEBUG] updateCheckoutLineItems: Subscription type selected:",o);let n="year"===o?"/year":"month"===o?"/month":"semester"===o?"/semester":"",d=document.querySelectorAll("#subscription_items_list tr.confirmed");console.log("[DEBUG] updateCheckoutLineItems: Found",d.length,"confirmed subscription rows.");let c=[];d.forEach((t,n)=>{let i=t.getAttribute("data-session-id");if(console.log(`[DEBUG] updateCheckoutLineItems: Processing subscription row ${n+1}, session id:`,i),!i)return;let s=l(e.sessions,i);if(!s)return;let r="";"year"===o?r=s.tuition_product.Displayed_annual_price:"month"===o?r=s.tuition_product.Displayed_monthly_price:"semester"===o&&(r=s.tuition_product.Displayed_semester_price),console.log(`[DEBUG] updateCheckoutLineItems: Price string for session ${i}:`,r);let a=parseFloat(r.replace(/[^0-9\.]/g,""))||0;console.log(`[DEBUG] updateCheckoutLineItems: Parsed unit price for session ${i}:`,a),c.push({productName:s.Name,quantity:1,unitPrice:a,total:a})}),console.log("[DEBUG] updateCheckoutLineItems: Subscription Items Array before grouping:",c);let u=a(c),p="";u.forEach((e,t)=>{p+=`
      <div class="line_item u-hflex-left-center u-text-small">
        <div id="subscription_item_product" class="text-weight-bold line_item_product">${e.productName}</div>
        <div id="subscription_item_unit_amount" class="line_item_unit_amount">$${e.unitPrice.toFixed(2)}</div>
        <div>x</div>
        <div id="subscription_item_quantity" class="line_item_quantity">${e.quantity}</div>
        <div id="subscription_item_total" class="line_item_total text-weight-bold">$${e.total.toFixed(2)} ${n}</div>
      </div>
    `,console.log(`[DEBUG] updateCheckoutLineItems: Built subscription line item ${t+1}:`,e)}),new(0,i.WFComponent)("#subscription_line_items_list").setHTML(p);let m=new i.WFComponent("#subscription_line_items_wrap"),g=new i.WFComponent("#subscription_line_items_empty");u.length>0?(m.getElement().style.display="flex",g.getElement().style.display="none"):(m.getElement().style.display="none",g.getElement().style.display="block");let f=u.reduce((e,t)=>e+t.total,0);console.log("[DEBUG] updateCheckoutLineItems: Subscription Total:",f),(0,s.saveState)({originalSubscriptionTotal:f}),console.log("[DEBUG] updateCheckoutLineItems: Updated originalSubscriptionTotal:",f);let h=!1,y=null;"month"===o&&d.forEach(t=>{let o=t.getAttribute("data-session-id");if(!o)return;let n=l(e.sessions,o);if(!n)return;let i=n.program["1st_Semester_Start_Date"];i&&i>Date.now()&&(h=!0,(null===y||i<y)&&(y=i))});let _=e.student_profiles?e.student_profiles.filter(e=>e.Status&&"pending"===e.Status.toLowerCase()):[],E=!1;_.length>0?E=!0:"month"===o&&h&&(E=!0);let b=0;E?(console.log("[DEBUG] updateCheckoutLineItems: Pending students or early registration detected."),console.log("[DEBUG] updateCheckoutLineItems: Deposit total computed:",b=function(e,t){console.log("[DEBUG] updateDepositLineItems: Starting deposit update...");let o=document.querySelectorAll("#subscription_items_list tr.confirmed");console.log("[DEBUG] updateDepositLineItems: Found",o.length,"confirmed subscription rows.");let n=[];o.forEach((t,o)=>{let i=t.getAttribute("data-session-id");if(console.log(`[DEBUG] updateDepositLineItems: Processing row ${o+1}, session id:`,i),!i)return;let s=l(e.sessions,i);if(!s||!s.deposit_product){console.log(`[DEBUG] updateDepositLineItems: No session or deposit product found for session id ${i}`);return}let r=s.deposit_product.Displayed_single_sale_price,a=parseFloat(r.replace(/[^0-9\.]/g,""))||0;console.log(`[DEBUG] updateDepositLineItems: Deposit price string: "${r}", parsed unit price: ${a}`),n.push({productName:s.Name,quantity:1,unitPrice:a,total:a})}),console.log("[DEBUG] updateDepositLineItems: Deposit Items Array before grouping:",n);let s=a(n),r="";s.forEach((e,t)=>{r+=`
      <div class="line_item u-hflex-left-center u-text-small">
        <div id="deposit_item_product" class="text-weight-bold">${e.productName}</div>
        <div id="deposit_item_unit_amount" class="line_item_unit_amount">$${e.unitPrice.toFixed(2)}</div>
        <div>x</div>
        <div id="deposit_item_quantity" class="line_item_quantity">${e.quantity}</div>
        <div id="deposit_item_total" class="line_item_total text-weight-bold">$${e.total.toFixed(2)}</div>
      </div>
    `,console.log(`[DEBUG] updateDepositLineItems: Built deposit line item ${t+1}:`,e)}),new(0,i.WFComponent)("#deposit_line_items_list").setHTML(r);let d=s.reduce((e,t)=>e+t.total,0);console.log("[DEBUG] updateDepositLineItems: Calculated deposit total:",d),new(0,i.WFComponent)("#deposit_total").setText(`$${d.toFixed(2)}`);let c=new i.WFComponent("#deposit_line_items_container"),u=s.length>0?"flex":"none";return c.getElement().style.display=u,console.log("[DEBUG] updateDepositLineItems: Deposit container display set to:",u),d}(e,0))):(new(0,i.WFComponent)("#deposit_line_items_container").getElement().style.display="none",console.log("[DEBUG] updateCheckoutLineItems: Deposit container hidden.")),(0,r.updateTotalAmount)(!1,o,b),function(e,t){if("month"!==t){new(0,i.WFComponent)("#alertBoxEarly").getElement().style.display="none";return}let o=document.querySelectorAll("#subscription_items_list tr.confirmed"),n=null;o.forEach(t=>{let o=t.getAttribute("data-session-id");if(!o)return;let i=l(e.sessions,o);if(!i)return;let s=i.program["1st_Semester_Start_Date"];s&&s>Date.now()&&(null===n||s<n)&&(n=s)});let s=new i.WFComponent("#alertBoxEarly"),r=new i.WFComponent("#subscription_start_date");if(n){let e=new Date(n).toLocaleDateString();r.setText(e),s.getElement().style.display="block",console.log("[DEBUG] updateEarlyAlert: Displaying early alert with start date:",e)}else s.getElement().style.display="none",console.log("[DEBUG] updateEarlyAlert: No upcoming start dates found, hiding early alert.")}(e,o)}},{"@xatom/core":"65YBq","../state/registrationState":"7PLg3","./updateTotalAmount":"8DFQT","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"8DFQT":[function(e,t,o){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(o),n.export(o,"updateTotalAmount",()=>r);var i=e("@xatom/core"),s=e("../state/registrationState");function r(e,t,o=0){let n=(0,s.loadState)(),r=n.originalSubscriptionTotal||0,l=n.selected_discount?parseFloat(n.selected_discount):0,a=r-l/100*r,d=t?"/"+t:"";new i.WFComponent("#subscription_discount_pill").getElement().style.display=l>0?"block":"none",new i.WFComponent("#subscription_discount_applied").setText(l>0?`${l}%`:"");let c=new i.WFComponent("#subscription_original_amount");l>0?(c.setText(`was $${r.toFixed(2)} ${d}`),c.getElement().style.display="block"):c.getElement().style.display="none",new i.WFComponent("#subscription_total").setText(`$${a.toFixed(2)} ${d}`),new i.WFComponent("#total_amount_due").setText(`$${(o>0?o:a).toFixed(2)}`)}},{"@xatom/core":"65YBq","../state/registrationState":"7PLg3","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"82j3J":[function(e,t,o){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(o),n.export(o,"initializeFinancialAid",()=>a),n.export(o,"saveFinancialAidData",()=>p),n.export(o,"loadFinancialAidData",()=>d);var i=e("@xatom/core"),s=e("../state/registrationState"),r=e("../../../utils/formUtils"),l=e("../../../utils/validationUtils");let a=()=>{d();let e=new i.WFComponent("#requestFinAid"),t=new i.WFComponent("#finaidForm");e.on("change",()=>{e.getElement().checked?t.getElement().showModal():((0,s.saveState)({fin_aid_requested:!1,selected_discount:void 0}),document.dispatchEvent(new CustomEvent("registrationChanged")))}),t.getElement()?.addEventListener("close",()=>{s.loadState().selected_discount||(e.getElement().checked=!1)}),c(),new i.WFComponent("#submitfinancialAid").on("click",()=>{u()&&(p(),m())}),f(t);let o=new i.WFComponent("#annualIncome"),n=new i.WFComponent("#monthlyExpense"),r=e=>{let t=e.getElement(),o=t.value.replace(/[^\d.-]/g,""),n=t.selectionStart||0,i=(t.value.slice(0,n).match(/,/g)||[]).length;if(o.includes(".")){let[e,t]=o.split(".");o=`${e}.${t.slice(0,2)}`}let s=l(o);t.value=s;let r=(s.slice(0,n).match(/,/g)||[]).length;(n+=r-i)>s.length&&(n=s.length),t.setSelectionRange(n,n)},l=e=>{let t=parseFloat(e.replace(/,/g,""));return isNaN(t)?e:t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})};o.on("input",()=>r(o)),n.on("input",()=>r(n))};function d(){let e=(0,s.loadState)(),t=new i.WFComponent("#requestFinAid");if(e.fin_aid_requested&&e.financialAidData){t.getElement().checked=!0;let o=new i.WFComponent("#finaidRelationship"),n=new i.WFComponent("#annualIncome"),s=new i.WFComponent("#monthlyExpense"),r=e.financialAidData.previousParticipant,l=document.getElementsByName("previous_participant");o.getElement().value=e.financialAidData.relationship||"",n.getElement().value=e.financialAidData.annualIncome||"",s.getElement().value=e.financialAidData.monthlyExpense||"",l.forEach(e=>{e.checked=e.value===r}),console.log("[DEBUG] loadFinancialAidData: Financial aid data loaded from state.")}else t.getElement().checked=!1}let c=()=>{let e=new i.WFComponent("#finaidRelationship"),t=new i.WFComponent("#finaidRelationshipError"),o=document.getElementsByName("previous_participant"),n=new i.WFComponent("#previousParticipantError"),s=new i.WFComponent("#annualIncome"),a=new i.WFComponent("#annualIncomeError"),d=new i.WFComponent("#monthlyExpense"),c=new i.WFComponent("#monthlyExpenseError");(0,r.setupValidation)(e,t,()=>(0,l.validateSelectField)(h(e))?"":"Please select a relationship."),(0,r.setupValidation)(s,a,()=>(0,l.validateNotEmpty)(h(s))?"":"Please enter your annual household income."),(0,r.setupValidation)(d,c,()=>(0,l.validateNotEmpty)(h(d))?"":"Please enter your monthly expenditure."),Array.from(o).forEach(e=>{(0,r.setupValidation)(new i.WFComponent(e),n,()=>Array.from(o).some(e=>e.checked)?"":"Please select an option.")})},u=()=>{let e=new i.WFComponent("#finaidRelationship"),t=new i.WFComponent("#annualIncome"),o=new i.WFComponent("#monthlyExpense"),n=document.getElementsByName("previous_participant"),s=(0,l.validateSelectField)(h(e));(0,r.toggleError)(new i.WFComponent("#finaidRelationshipError"),"Please select a relationship.",!s);let a=(0,l.validateNotEmpty)(h(t));(0,r.toggleError)(new i.WFComponent("#annualIncomeError"),"Please enter your annual household income.",!a);let d=(0,l.validateNotEmpty)(h(o));(0,r.toggleError)(new i.WFComponent("#monthlyExpenseError"),"Please enter your monthly expenditure.",!d);let c=Array.from(n).some(e=>e.checked);return(0,r.toggleError)(new i.WFComponent("#previousParticipantError"),"Please select an option.",!c),s&&a&&d&&c},p=()=>{let e=new(0,i.WFComponent)("#finaidRelationship").getElement().value,t=new(0,i.WFComponent)("#annualIncome").getElement().value,o=new(0,i.WFComponent)("#monthlyExpense").getElement().value,n=document.querySelector("input[name='previous_participant']:checked"),r=n?n.value:"";(0,s.saveState)({fin_aid_requested:!0,selected_discount:"",financialAidData:{relationship:e,annualIncome:t,monthlyExpense:o,previousParticipant:r}}),console.log("[DEBUG] saveFinancialAidData: Financial aid data saved:",{relationship:e,annualIncome:t,monthlyExpense:o,previousParticipant:r})},m=()=>{let e=new i.WFComponent(".success-message"),t=new i.WFComponent("#wf-form-Finaid-Form");t.setStyle({display:"none"}),e.setStyle({display:"block"});let o=new i.WFComponent("#applyDiscount"),n=new i.WFComponent("#backFinAid"),r=new i.WFComponent("#finaidForm");o.on("click",()=>{let e=document.querySelector("input[name='discountValue']:checked");if(e){let t=e.value;(0,s.saveState)({selected_discount:t,fin_aid_requested:!0}),document.dispatchEvent(new CustomEvent("registrationChanged")),g(r)}else console.warn("No discount selected.")}),n.on("click",()=>{e.setStyle({display:"none"}),t.setStyle({display:"flex"})})},g=e=>{e.getElement().close()},f=e=>{new i.WFComponent("#close-dialog-btn").on("click",()=>g(e)),e.getElement()?.addEventListener("click",t=>{let o=e.getElement().getBoundingClientRect();(t.clientX<o.left||t.clientX>o.right||t.clientY<o.top||t.clientY>o.bottom)&&g(e)})},h=e=>e.getElement().value},{"@xatom/core":"65YBq","../state/registrationState":"7PLg3","../../../utils/formUtils":"gepHz","../../../utils/validationUtils":"gu2z7","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],gepHz:[function(e,t,o){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(o),n.export(o,"toggleError",()=>a),n.export(o,"setupValidation",()=>d),n.export(o,"createValidationFunction",()=>c),n.export(o,"createCheckboxValidationFunction",()=>u),n.export(o,"setupCheckboxValidation",()=>p),n.export(o,"validateSelectedSessions",()=>m),n.export(o,"setProfilePicUrl",()=>g),n.export(o,"setupFileUpload",()=>f),n.export(o,"formatPhoneNumber",()=>h);var i=e("@xatom/core"),s=e("@xatom/image"),r=e("../api/apiConfig"),l=e("../auth/authConfig");function a(e,t,o){e.updateTextViaAttrVar({text:o?t:""}),e.setStyle({display:o?"flex":"none"})}function d(e,t,o,n){let i=()=>{let e=o();a(t,e,!!e),n&&""===e&&a(n,"",!1)};e.on("input",i),e.on("blur",i),e.on("change",i)}function c(e,t,o){return()=>t(e.getElement().value)?"":o}function u(e,t){return()=>e.getElement().checked?"":t}function p(e,t,o){let n=u(e,o);d(e,t,n)}function m(e,t,o){let n=e.length>0&&e.some(e=>e.studentIds.length>0);return n?a(t,"",!1):a(t,o,!0),n}function g(e){let t=(0,l.userAuth).getUser();t&&t.profile&&(t.profile.profile_pic=t.profile.profile_pic||{url:""},t.profile.profile_pic.url=e,(0,l.userAuth).setUser(t),localStorage.setItem("auth_user",JSON.stringify(t)))}function f(e,t,o,n){let l=new s.WFImage("#profilePictureImage"),d=new i.WFComponent("#uploadAnimation"),c=new i.WFComponent(".drop-zone"),u=0;return new Promise(i=>{let s=s=>{if(!["image/jpeg","image/jpg"].includes(s.type)&&!/\.(jpg|jpeg)$/i.test(s.name)){a(t,"Only JPEG images are allowed.",!0),e.getElement().value="";return}if(s.size>2097152){a(t,"File size must be less than 2 MB.",!0),e.getElement().value="";return}d.setStyle({display:"flex"}),t.setStyle({display:"none"}),o.setStyle({display:"none"});let p=new FileReader;p.onload=e=>{let t=e.target?.result;l.setImage(t),c.setStyle({display:"none"})},p.readAsDataURL(s);let m=new FormData;m.append("profile_picture",s);let f=localStorage.getItem("current_student");if(f){let e=JSON.parse(f);m.append("student_profile_id",e.id.toString())}let h=(0,r.apiClient).post(n,{data:m});h.onData(n=>{if("success"===n.status){let e=n.url.profile_pic.url;g(e),l.setImage(e),localStorage.setItem("image_upload",e),o.setStyle({display:"flex"}),d.setStyle({display:"none"}),i(e)}else a(t,"Failed to upload profile picture.",!0),d.setStyle({display:"none"}),c.setStyle({display:"none"}),u=0,e.getElement().value=""}),h.onError(o=>{let n="An error occurred during image upload.";o.response&&o.response.data?n=o.response.data.message||n:o.message&&(n=o.message),a(t,n,!0),d.setStyle({display:"none"}),c.setStyle({display:"none"}),u=0,e.getElement().value=""}),h.fetch()};e.on("change",()=>{let t=e.getElement().files?.[0];t&&s(t)});let p=document.body;p.addEventListener("dragenter",e=>{e.preventDefault(),1==++u&&c.setStyle({display:"flex"})}),p.addEventListener("dragleave",()=>{--u<=0&&(c.setStyle({display:"none"}),u=0)}),p.addEventListener("dragover",e=>{e.preventDefault()}),p.addEventListener("drop",e=>{e.preventDefault();let t=e.dataTransfer?.files;t?.length&&s(t[0]),c.setStyle({display:"none"}),u=0})})}let h=e=>{let t=e.replace(/\D/g,"");return t.length<=3?t:t.length<=6?`(${t.slice(0,3)}) ${t.slice(3)}`:t.length<=10?`(${t.slice(0,3)}) ${t.slice(3,6)}-${t.slice(6)}`:`(${t.slice(0,3)}) ${t.slice(3,6)}-${t.slice(6,10)}`}},{"@xatom/core":"65YBq","@xatom/image":"bavwf","../api/apiConfig":"dUmIV","../auth/authConfig":"dHwPR","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],bavwf:[function(e,t,o){var n,i=e("d023971cccd819e3"),s={};Object.defineProperty(s,"WFImage",{get:()=>r,set:void 0,enumerable:!0,configurable:!0});class r extends i.WFComponent{constructor(e){super(e)}getImageConfig(){return this._config}getSrc(){return this.getAttribute("src")}getSizes(){return this.getAttribute("sizes")}getSrcSet(){return this.getAttribute("srcset")}getLoading(){return this.getAttribute("loading")}onLoad(e){return this.on("load",e),()=>{this.off("load",e)}}onLoadError(e){return this.on("error",e),()=>{this.off("error",e)}}setImage(e){if("string"==typeof e)this.setAttribute("src",e),this.removeAttribute("srcset"),this.removeAttribute("sizes");else{if(this.setAttribute("src",e.src),"object"==typeof e&&e.srcSet&&e.srcSet.length&&e.sizes&&e.sizes.length){let t=e.srcSet.map(e=>`${e.url} ${e.size}`).join(", ");this.setAttribute("srcset",t)}else this.removeAttribute("srcset"),this.removeAttribute("sizes");e.loading&&this.setAttribute("loading",e.loading)}}}n=t.exports,Object.keys(s).forEach(function(e){"default"===e||"__esModule"===e||n.hasOwnProperty(e)||Object.defineProperty(n,e,{enumerable:!0,get:function(){return s[e]}})})},{d023971cccd819e3:"65YBq"}],gu2z7:[function(e,t,o){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");function i(e){return void 0!==e&&""!==e.trim()}function s(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}n.defineInteropFlag(o),n.export(o,"validateNotEmpty",()=>i),n.export(o,"validateEmail",()=>s),n.export(o,"validateEmailOptional",()=>r),n.export(o,"validatePasswordRequirements",()=>l),n.export(o,"validateCheckbox",()=>a),n.export(o,"validatePasswordsMatch",()=>d),n.export(o,"validateSelectField",()=>c),n.export(o,"validatePhoneNumber",()=>u),n.export(o,"validatePhoneNumberOptional",()=>p);let r=e=>""===e.trim()||s(e);function l(e){let t=/[a-z]/.test(e),o=/[A-Z]/.test(e),n=/\d/.test(e),i=/[!@#$%^&*(),.?":{}|<>]/.test(e),s=e.length>=8;return t&&o&&n&&i&&s}function a(e){return e}function d(e,t){return e===t}function c(e){return void 0!==e&&"N/A"!==e}function u(e){return/^\(\d{3}\)\s\d{3}-\d{4}$/.test(e)}let p=e=>""===e.trim()||u(e)},{"@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],fBuhT:[function(e,t,o){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(o),n.export(o,"updatePendingStudentsAlert",()=>s);var i=e("@xatom/core");function s(e){let t=new i.WFComponent("#alertBox"),o=new i.WFComponent("#alertPendingStudentList");if(e.student_profiles&&Array.isArray(e.student_profiles)){let n=e.student_profiles.filter(e=>e.Status&&"pending"===e.Status.toLowerCase());if(n.length>0){let e=n.map(e=>e.full_name).join(", ");o.setText(e),t.getElement().style.display="flex";return}}t.getElement().style.display="none"}},{"@xatom/core":"65YBq","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],aW9bX:[function(e,t,o){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(o),n.export(o,"submitCheckout",()=>d);var i=e("@xatom/core"),s=e("../state/registrationState"),r=e("../../../utils/formUtils"),l=e("../../../api/apiConfig");function a(e,t){let o=e.find(e=>e.id.toString()===t);return console.log(`[DEBUG] checkoutSubmission - getSessionById: Looking for session id ${t}:`,o),o}async function d(){let e=(0,s.loadState)();if(!e.apiData){console.error("No API data found in state."),c("No API data found in state.");return}let t=e.apiData,o=Array.from(document.querySelectorAll("#subscription_items_list tr.confirmed")),n=o.map(e=>({program_id:e.getAttribute("data-program-id"),session_id:e.getAttribute("data-session-id"),student_id:e.getAttribute("data-student-id")})),d=new Map;o.forEach(o=>{let n=o.getAttribute("data-session-id");if(!n)return;let i=a(t.sessions,n);if(!i)return;let s="";if("year"===e.subscriptionType?s=i.tuition_product.Annual_price_id:"month"===e.subscriptionType?s=i.tuition_product.Monthly_price_id:"semester"===e.subscriptionType&&(s=i.tuition_product.Semester_price_id),!s)return;let r=d.get(s)||0;d.set(s,r+1)});let u=Array.from(d.entries()).map(([e,t])=>({price:e,quantity:t}));console.log("[DEBUG] submitCheckout: Subscription line items",u);let p=!1,m=null;"month"===e.subscriptionType&&o.forEach(e=>{let o=e.getAttribute("data-session-id");if(!o)return;let n=a(t.sessions,o);if(!n)return;let i=n.program["1st_Semester_Start_Date"];i&&i>Date.now()&&(p=!0,(null===m||i<m)&&(m=i))}),console.log("[DEBUG] submitCheckout: Early registration =",p,"Earliest start date =",m);let g=t.student_profiles?t.student_profiles.filter(e=>e.Status&&"pending"===e.Status.toLowerCase()):[];console.log("[DEBUG] submitCheckout: Pending students",g);let f=null;if(g.length>0||"month"===e.subscriptionType&&p){let o=new Map;(e.registrationItems||[]).forEach(e=>{let n=e.session_id;if(!n)return;let i=a(t.sessions,n);if(!i||!i.deposit_product)return;let s=i.deposit_product.Single_sale_price_id;if(!s)return;let r=o.get(s)||0;o.set(s,r+1)}),f=o.size>0?Array.from(o.entries()).map(([e,t])=>({price:e,quantity:t})):null}console.log("[DEBUG] submitCheckout: Deposit line items",f);let h=parseFloat((new(0,i.WFComponent)("#total_amount_due").getElement().textContent||"").replace(/[^0-9\.]/g,""))||0,y=e.originalSubscriptionTotal||0,_=(e.selected_discount?parseFloat(e.selected_discount):0)/100*y,E={registration_items:n,subscription_line_items:u,deposit_line_items:f,financial_aid:{requested:e.fin_aid_requested,selected_discount:e.selected_discount,data:e.financialAidData},subscription_type:e.subscriptionType,early_registration:p,earliest_start_date:m,subscription_subtotal:y,subscription_amount_discount:_,subscription_total:y-_,total_due:h,students_pending:g.length>0,base_url:window.location.origin};console.log("[DEBUG] submitCheckout: Payload",E);try{let e=await (0,l.apiClient).post("/registration/checkout",{data:E}).fetch();if(console.log("[DEBUG] submitCheckout: Response",e),e.url)(function(){let e=new i.WFComponent("#registration_checkout_error");(0,r.toggleError)(e,"",!1)})(),window.location.href=e.url;else throw Error("No checkout URL returned")}catch(e){console.error("Error submitting checkout",e),c(e.message||"An error occurred during checkout.")}}function c(e){let t=new i.WFComponent("#registration_checkout_error");(0,r.toggleError)(t,e,!0)}},{"@xatom/core":"65YBq","../state/registrationState":"7PLg3","../../../utils/formUtils":"gepHz","../../../api/apiConfig":"dUmIV","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],j6atX:[function(e,t,o){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(o),n.export(o,"loadRegistrationUI",()=>s);var i=e("../state/registrationState");function s(){let e=(0,i.loadState)();if(!e.registrationItems||0===e.registrationItems.length){console.log("[DEBUG] loadRegistrationUI: No registration items to load.");return}let t=document.getElementById("subscription_items_list");if(!t){console.error("Table body not found.");return}let o=document.getElementById("subscription_item");if(!o){console.error("Template row not found.");return}o.style.display="none",Array.from(t.getElementsByTagName("tr")).forEach(e=>{"subscription_item"!==e.id&&e.remove()});let n=document.getElementById("subscription_empty");n&&(n.style.display="none"),e.registrationItems.forEach(e=>{let n=o.cloneNode(!0);n.removeAttribute("id"),n.classList.add("confirmed"),n.style.display="table-row",n.setAttribute("data-program-id",e.program_id||""),n.setAttribute("data-session-id",e.session_id||""),n.setAttribute("data-student-id",e.student_id||"");let s=n.querySelector("#item_program_name");s&&(s.textContent=e.program_name||"",s.style.display="block");let r=n.querySelector("#item_workshop_name");r&&(r.textContent=e.workshop_name||"",r.style.display="block");let l=n.querySelector("#item_session_name");l&&(l.textContent=e.session_name||"",l.style.display="block");let a=n.querySelector("#item_student_name");a&&(a.textContent=e.student_name||"",a.style.display="block"),n.querySelectorAll("select").forEach(e=>e.style.display="none");let d=n.querySelector(".add_registration_button");d&&(d.style.display="none");let c=n.querySelector(".remove_registration_button");c&&c.addEventListener("click",()=>{n.remove();let e=((0,i.loadState)().registrationItems||[]).filter(e=>!(e.session_id===n.getAttribute("data-session-id")&&e.student_id===n.getAttribute("data-student-id")));if((0,i.saveState)({registrationItems:e}),0===Array.from(t.getElementsByTagName("tr")).filter(e=>"subscription_item"!==e.id).length){let e=document.getElementById("subscription_empty");e&&(e.style.display="table-row")}document.dispatchEvent(new CustomEvent("registrationChanged"))}),t.appendChild(n)}),console.log("[DEBUG] loadRegistrationUI: UI reloaded from state.")}},{"../state/registrationState":"7PLg3","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"6YvTl":[function(e,t,o){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(o),n.export(o,"showActionRequiredDialogIfNoStudentProfiles",()=>s);var i=e("@xatom/core");function s(e){if(!e.student_profiles||0===e.student_profiles.length){let e=new i.WFComponent("#actionRequiredDialog").getElement();e instanceof HTMLDialogElement?e.showModal():e.style.display="block";let t=document.getElementById("alertDialogAnimationTrigger");t&&t.click()}}},{"@xatom/core":"65YBq","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}]},[],0,"parcelRequired346");
//# sourceMappingURL=registration_new.0ea7d84b.js.map
