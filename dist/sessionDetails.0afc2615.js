!function(e,t,o,r,n){var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s="function"==typeof i[r]&&i[r],a=s.cache||{},l="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function d(t,o){if(!a[t]){if(!e[t]){var n="function"==typeof i[r]&&i[r];if(!o&&n)return n(t,!0);if(s)return s(t,!0);if(l&&"string"==typeof t)return l(t);var u=Error("Cannot find module '"+t+"'");throw u.code="MODULE_NOT_FOUND",u}m.resolve=function(o){var r=e[t][1][o];return null!=r?r:o},m.cache={};var c=a[t]=new d.Module(t);e[t][0].call(c.exports,m,c,c.exports,this)}return a[t].exports;function m(e){var t=m.resolve(e);return!1===t?{}:d(t)}}d.isParcelRequire=!0,d.Module=function(e){this.id=e,this.bundle=d,this.exports={}},d.modules=e,d.cache=a,d.parent=s,d.register=function(t,o){e[t]=[function(e,t){t.exports=o},{}]},Object.defineProperty(d,"root",{get:function(){return i[r]}}),i[r]=d;for(var u=0;u<t.length;u++)d(t[u])}({fChp6:[function(e,t,o){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(o),r.export(o,"initializeSessionDetails",()=>d);var n=e("@xatom/core"),i=e("../../../api/apiConfig"),s=e("./components/removeStudent"),a=e("./components/listSessionFiles");async function l(e,t,o,r){try{let n=(0,i.apiClient).get(`/dashboard/registration/session/${o}`,{data:{workshop_id:e,program_id:t,session_id:o,subscription:r}});return await n.fetch()}catch(t){let e="An unexpected error occurred. Please try again.";t?.response?.data?.message?e=t.response.data.message:t.message&&(e=t.message),alert(`Error: ${e}`),window.history.length>1?window.history.back():window.location.href="/dashboard/registrations",console.error("Fetch Session Details Error:",t);return}}async function d(){var e;(0,a.initializeDynamicSessionFileList)("#filesList");let t=new URLSearchParams(window.location.search),o=t.get("workshop")||"none",r=t.get("program"),i=t.get("session"),d=t.get("subscription");if(!r||!i||!d){u("Invalid access. Program ID, Session ID, or Subscription ID is missing.");return}let c=await l(o,r,i,d);if(!c)return;let{workshop:m,subscription:p,program:g,students:f,location:h,session:b,caregiver:y}=c;c&&h&&f&&b?(m?(new n.WFComponent("#workshopName").setText(m.fieldData.name),new n.WFComponent("#workshopShortDescription").setText(m.fieldData["short-description"])):(new n.WFComponent("#workshopName").setText(g.fieldData.name),new n.WFComponent("#workshopShortDescription").setText(g.fieldData["short-description"])),function(e,t){new n.WFComponent("#sessionWeekday").setText(e.fieldData.weekday),new n.WFComponent("#sessionTime").setText(e.fieldData["time-block"]),new n.WFComponent("#sessionLocation").setText(t.fieldData.name),new n.WFComponent("#sessionLocationMap").setHTML(t.fieldData["map-embed"]);let o=document.querySelector("#sessionLocationMap figure"),r=document.querySelector("#sessionLocationMap iframe"),i=document.querySelector("#sessionLocationMap figure > div");o&&(o.style.width="100%",o.style.height="100%",o.style.padding="0",o.style.margin="0"),i&&(i.style.height="100%"),r&&(r.style.width="100%",r.style.height="100%",r.style.border="0")}(b,h),function(e){let t=new n.WFDynamicList("#listStudentProfiles",{rowSelector:"#listStudentCard",loaderSelector:"#listStudentProfilesloading",emptySelector:"#listStudentProfilesEmpty"});t.rowRenderer(({rowData:e,rowElement:t})=>{let o=new n.WFComponent(t),r=o.getChildAsComponent("#studentName"),i=o.getChildAsComponent("#listStudentCardImage"),s=o.getChildAsComponent("#studentLink"),a=o.getChildAsComponent(".remove_button");r?.setText(e.student_name),i?.setAttribute("src",e.image_url);let l=e.student_profile_id,d=new URL(s?.getAttribute("href")||"#",window.location.origin);return d.searchParams.set("id",l.toString()),s?.setAttribute("href",d.toString()),a?.setAttribute("data-student-id",l.toString()),a?.setAttribute("data-subscription-item-id",e.id.toString()),t.setAttribute("data-student-id",l.toString()),t}),t.setData(e)}(f),function(e,t,o,r,i,s){let a=document.querySelector("#programBreadcrumb");if(a){let t=new n.WFComponent(a);t.setText(e.fieldData.name);let o=new URL(a.getAttribute("href")||"#",window.location.origin);o.searchParams.set("program",e.id),t.setAttribute("href",o.toString())}let l=document.querySelector("#workshopBreadcrumb");if(l){let o=new n.WFComponent(l);t?o.setText(t.fieldData.name):o.setText(e.fieldData.name);let s=new URL(l.getAttribute("href")||"#",window.location.origin);s.searchParams.set("program",e.id),s.searchParams.set("subscription",r),t&&"none"!==i&&s.searchParams.set("workshop",i),o.setAttribute("href",s.toString())}let d=document.querySelector("#sessionBreadcrumb");if(d){let e=new n.WFComponent(d),t=`${o.fieldData.weekday}, ${o.fieldData["time-block"]}`;e.setText(t)}(function(e,t,o,r,i,s){if(e){document.querySelectorAll(".remove_button_wrap").forEach(e=>e.remove());let e=document.querySelector("#userBreadcumbList"),t=document.querySelector("#caregiverBreadcrumbList");e&&e.setAttribute("style","display: none;"),t&&t.setAttribute("style","display: flex;");let o=localStorage.getItem("caregiver_breadcrumbs");if(o)try{let e=JSON.parse(o),t=document.querySelector("#studentBreadcrumb");if(t){let o=new n.WFComponent(t);o.setText(e.student_name);let r=t.getAttribute("href")||"/dashboard/student/profile",i=new URL(r,window.location.origin);i.searchParams.set("id",e.student_id.toString()),o.setAttribute("href",i.toString())}let r=document.querySelector("#caregiverWorkshopBreadcrumb");if(r){let t=new n.WFComponent(r),o=e.workshop_name?e.workshop_name:e.program_name;t.setText(o);let i=r.getAttribute("href")||"#",s=new URL(i,window.location.origin);s.searchParams.set("program",e.program_id),s.searchParams.set("subscription",e.subscription_id.toString()),e.workshop_id&&"none"!==e.workshop_id&&s.searchParams.set("workshop",e.workshop_id),r.setAttribute("href",s.toString())}let i=document.querySelector("#caregiverSessionBreadcrumb");if(i){let t=new n.WFComponent(i),o=`${e.session_weekday}, ${e.session_time_block}`;t.setText(o)}}catch(e){console.error("Error parsing caregiver_breadcrumbs from localStorage:",e),alert("Failed to load caregiver breadcrumbs. Please try again.")}else console.warn("No caregiver_breadcrumbs found in localStorage."),alert("Caregiver breadcrumbs data is missing.")}else{let e=document.querySelector("#userBreadcumbList"),t=document.querySelector("#caregiverBreadcrumbList");e&&e.setAttribute("style","display: flex;"),t&&t.setAttribute("style","display: none;")}})(s,0,0,0,0,0)}(g,m,b,d,o,y),e=p.id,y||new s.RemoveStudentDialog({subscriptionId:e,sessionId:i,students:f.map(e=>({id:e.id,student_profile_id:e.student_profile_id,student_name:e.student_name}))}),function(e){let t=document.querySelector(e);t instanceof HTMLElement&&t.click()}(".success_trigger")):u("Failed to fetch session details. Incomplete data.")}function u(e){let t=document.querySelector("#listRegistrationEmpty");t&&(t.innerHTML=`<div>${e}</div>`,t.setAttribute("style","display: flex;")),alert(`Error: ${e}`)}},{"@xatom/core":"65YBq","../../../api/apiConfig":"dUmIV","./components/removeStudent":"j5BUu","./components/listSessionFiles":"9Xmw3","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],j5BUu:[function(e,t,o){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(o),r.export(o,"RemoveStudentDialog",()=>l);var n=e("@xatom/core"),i=e("../../../../api/apiConfig"),s=e("../../../../utils/validationUtils"),a=e("../../../../utils/formUtils");class l{constructor(e){let{subscriptionId:t,sessionId:o,students:r}=e;this.subscriptionId=t,this.sessionId=o,this.students=r,this.dialog=new n.WFComponent("#removeStudentDialog"),this.removeForm=new n.WFFormComponent("#cancelSubscriptionForm"),this.pageMain=new n.WFComponent(".page_main"),this.initialize()}initialize(){let e=document.querySelectorAll(".remove_button");if(0===e.length){console.error("Remove buttons not found");return}e.forEach(e=>{e.addEventListener("click",e=>{let t=e.currentTarget,o=t.getAttribute("data-student-id"),r=t.getAttribute("data-subscription-item-id");if(console.log("Clicked remove button:",{studentProfileId:o,subscriptionItemId:r}),!o||!r){console.error("Missing data attributes on remove button",{studentProfileId:o,subscriptionItemId:r}),alert("Unable to remove student. Missing necessary data.");return}let n=this.students.find(e=>e.student_profile_id.toString()===o);n?(this.studentId=n.student_profile_id.toString(),this.subscriptionItemId=n.id,this.openDialog(n.student_name)):(console.error("Student not found in provided student list",{studentProfileId:o,students:this.students}),alert("Student not found. Please try again."))})});let t=new n.WFComponent("#close-dialog-btn");t.getElement()?t.on("click",()=>{this.closeDialog()}):console.error("Close dialog button not found"),this.setupFormSubmission(),this.setupFormValidation()}openDialog(e){if(this.dialog.getElement()&&this.pageMain.getElement()){console.log("Opening remove student dialog"),new n.WFComponent("#removeStudentName").setText(e),this.pageMain.getElement()?this.pageMain.setAttribute("data-brand","6"):console.error("page_main element not found");let t=this.dialog.getElement();t?t.showModal():console.error("Dialog element not found")}else console.error("Dialog or page_main element not found")}closeDialog(){if(this.dialog.getElement()&&this.pageMain.getElement()){console.log("Closing remove student dialog"),this.pageMain.getElement()?this.pageMain.setAttribute("data-brand","2"):console.error("page_main element not found");let e=this.dialog.getElement();e?e.close():console.error("Dialog element not found")}else console.error("Dialog or page_main element not found")}setupFormSubmission(){this.removeForm.onFormSubmit(async(e,t)=>{t.preventDefault(),t.stopPropagation(),console.log("Remove student form submission intercepted");let o=e.removed_because;if(!(0,s.validateNotEmpty)(o)){let e=new n.WFComponent("#removedReasonError");(0,a.toggleError)(e,"Reason for removing the student is required.",!0);return}try{if(this.setLoadingState(!0),!this.studentId||!this.subscriptionItemId)throw Error("No student ID or subscription item ID found for removal.");if(console.log("Submitting removal to API for student ID:",this.studentId,"with subscription item ID:",this.subscriptionItemId),await (0,i.apiClient).delete(`/subscriptions/${this.subscriptionId}/session/${this.sessionId}/student/${this.studentId}`,{data:{reason:o,subscription_item_id:this.subscriptionItemId}}).fetch()){console.log("Student removed successfully");let e=new n.WFComponent("#removedReasonError");(0,a.toggleError)(e,"",!1),this.closeDialog(),this.removeStudentFromUI(this.studentId)}else throw Error("Unexpected response received from student removal API.")}catch(e){console.error("Error removing student: ",e),this.showErrorMessage("Oops! Something went wrong while submitting the form.")}finally{this.setLoadingState(!1)}})}setupFormValidation(){let e=new n.WFComponent("#removedReason"),t=new n.WFComponent("#removedReasonError");if(!e.getElement()||!t.getElement()){console.error("Reason input or error component not found for validation");return}let o=(0,a.createValidationFunction)(e,e=>(0,s.validateNotEmpty)(e),"Reason for removing the student is required.");(0,a.setupValidation)(e,t,o)}setLoadingState(e){let t=new n.WFComponent("#removeStudentRequesting"),o=new n.WFComponent("#removeStudentSubmit");t.getElement()&&o.getElement()?e?(t.setStyle({display:"block"}),o.setAttribute("disabled","true")):(t.setStyle({display:"none"}),o.removeAttribute("disabled")):console.error("Loading animation or submit button not found for setting loading state")}removeStudentFromUI(e){let t=document.querySelector(`#listStudentCard[data-student-id="${e}"]`);t?(t.remove(),console.log(`Removed student row with data-student-id="${e}" from UI.`)):console.error(`Student row with data-student-id="${e}" not found in DOM.`)}showErrorMessage(e){let t=new n.WFComponent("#submitInviteCaregiverError");t.getElement()?(t.setText(e),t.setStyle({display:"flex"})):console.error("Error element not found for showing error message")}}},{"@xatom/core":"65YBq","../../../../api/apiConfig":"dUmIV","../../../../utils/validationUtils":"gu2z7","../../../../utils/formUtils":"gepHz","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],gu2z7:[function(e,t,o){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(e){return void 0!==e&&""!==e.trim()}function i(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}r.defineInteropFlag(o),r.export(o,"validateNotEmpty",()=>n),r.export(o,"validateEmail",()=>i),r.export(o,"validateEmailOptional",()=>s),r.export(o,"validatePasswordRequirements",()=>a),r.export(o,"validateCheckbox",()=>l),r.export(o,"validatePasswordsMatch",()=>d),r.export(o,"validateSelectField",()=>u),r.export(o,"validatePhoneNumber",()=>c),r.export(o,"validatePhoneNumberOptional",()=>m);let s=e=>""===e.trim()||i(e);function a(e){let t=/[a-z]/.test(e),o=/[A-Z]/.test(e),r=/\d/.test(e),n=/[!@#$%^&*(),.?":{}|<>]/.test(e),i=e.length>=8;return t&&o&&r&&n&&i}function l(e){return e}function d(e,t){return e===t}function u(e){return void 0!==e&&"N/A"!==e}function c(e){return/^\(\d{3}\)\s\d{3}-\d{4}$/.test(e)}let m=e=>""===e.trim()||c(e)},{"@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],gepHz:[function(e,t,o){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(o),r.export(o,"toggleError",()=>l),r.export(o,"setupValidation",()=>d),r.export(o,"createValidationFunction",()=>u),r.export(o,"createCheckboxValidationFunction",()=>c),r.export(o,"setupCheckboxValidation",()=>m),r.export(o,"validateSelectedSessions",()=>p),r.export(o,"setProfilePicUrl",()=>g),r.export(o,"setupFileUpload",()=>f),r.export(o,"formatPhoneNumber",()=>h);var n=e("@xatom/core"),i=e("@xatom/image"),s=e("../api/apiConfig"),a=e("../auth/authConfig");function l(e,t,o){e.updateTextViaAttrVar({text:o?t:""}),e.setStyle({display:o?"flex":"none"})}function d(e,t,o,r){let n=()=>{let e=o();l(t,e,!!e),r&&""===e&&l(r,"",!1)};e.on("input",n),e.on("blur",n),e.on("change",n)}function u(e,t,o){return()=>t(e.getElement().value)?"":o}function c(e,t){return()=>e.getElement().checked?"":t}function m(e,t,o){let r=c(e,o);d(e,t,r)}function p(e,t,o){let r=e.length>0&&e.some(e=>e.studentIds.length>0);return r?l(t,"",!1):l(t,o,!0),r}function g(e){let t=(0,a.userAuth).getUser();t&&t.profile&&(t.profile.profile_pic=t.profile.profile_pic||{url:""},t.profile.profile_pic.url=e,(0,a.userAuth).setUser(t),localStorage.setItem("auth_user",JSON.stringify(t)))}function f(e,t,o,r){let a=new i.WFImage("#profilePictureImage"),d=new n.WFComponent("#uploadAnimation"),u=new n.WFComponent(".drop-zone"),c=0;return new Promise(n=>{let i=i=>{if(!["image/jpeg","image/jpg"].includes(i.type)&&!/\.(jpg|jpeg)$/i.test(i.name)){l(t,"Only JPEG images are allowed.",!0),e.getElement().value="";return}if(i.size>2097152){l(t,"File size must be less than 2 MB.",!0),e.getElement().value="";return}d.setStyle({display:"flex"}),t.setStyle({display:"none"}),o.setStyle({display:"none"});let m=new FileReader;m.onload=e=>{let t=e.target?.result;a.setImage(t),u.setStyle({display:"none"})},m.readAsDataURL(i);let p=new FormData;p.append("profile_picture",i);let f=localStorage.getItem("current_student");if(f){let e=JSON.parse(f);p.append("student_profile_id",e.id.toString())}let h=(0,s.apiClient).post(r,{data:p});h.onData(r=>{if("success"===r.status){let e=r.url.profile_pic.url;g(e),a.setImage(e),localStorage.setItem("image_upload",e),o.setStyle({display:"flex"}),d.setStyle({display:"none"}),n(e)}else l(t,"Failed to upload profile picture.",!0),d.setStyle({display:"none"}),u.setStyle({display:"none"}),c=0,e.getElement().value=""}),h.onError(o=>{let r="An error occurred during image upload.";o.response&&o.response.data?r=o.response.data.message||r:o.message&&(r=o.message),l(t,r,!0),d.setStyle({display:"none"}),u.setStyle({display:"none"}),c=0,e.getElement().value=""}),h.fetch()};e.on("change",()=>{let t=e.getElement().files?.[0];t&&i(t)});let m=document.body;m.addEventListener("dragenter",e=>{e.preventDefault(),1==++c&&u.setStyle({display:"flex"})}),m.addEventListener("dragleave",()=>{--c<=0&&(u.setStyle({display:"none"}),c=0)}),m.addEventListener("dragover",e=>{e.preventDefault()}),m.addEventListener("drop",e=>{e.preventDefault();let t=e.dataTransfer?.files;t?.length&&i(t[0]),u.setStyle({display:"none"}),c=0})})}let h=e=>{let t=e.replace(/\D/g,"");return t.length<=3?t:t.length<=6?`(${t.slice(0,3)}) ${t.slice(3)}`:t.length<=10?`(${t.slice(0,3)}) ${t.slice(3,6)}-${t.slice(6)}`:`(${t.slice(0,3)}) ${t.slice(3,6)}-${t.slice(6,10)}`}},{"@xatom/core":"65YBq","@xatom/image":"bavwf","../api/apiConfig":"dUmIV","../auth/authConfig":"dHwPR","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],bavwf:[function(e,t,o){var r,n=e("d023971cccd819e3"),i={};Object.defineProperty(i,"WFImage",{get:()=>s,set:void 0,enumerable:!0,configurable:!0});class s extends n.WFComponent{constructor(e){super(e)}getImageConfig(){return this._config}getSrc(){return this.getAttribute("src")}getSizes(){return this.getAttribute("sizes")}getSrcSet(){return this.getAttribute("srcset")}getLoading(){return this.getAttribute("loading")}onLoad(e){return this.on("load",e),()=>{this.off("load",e)}}onLoadError(e){return this.on("error",e),()=>{this.off("error",e)}}setImage(e){if("string"==typeof e)this.setAttribute("src",e),this.removeAttribute("srcset"),this.removeAttribute("sizes");else{if(this.setAttribute("src",e.src),"object"==typeof e&&e.srcSet&&e.srcSet.length&&e.sizes&&e.sizes.length){let t=e.srcSet.map(e=>`${e.url} ${e.size}`).join(", ");this.setAttribute("srcset",t)}else this.removeAttribute("srcset"),this.removeAttribute("sizes");e.loading&&this.setAttribute("loading",e.loading)}}}r=t.exports,Object.keys(i).forEach(function(e){"default"===e||"__esModule"===e||r.hasOwnProperty(e)||Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})})},{d023971cccd819e3:"65YBq"}],"9Xmw3":[function(e,t,o){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(o),r.export(o,"fetchSessionFiles",()=>s),r.export(o,"initializeDynamicSessionFileList",()=>a);var n=e("@xatom/core"),i=e("../../../../api/apiConfig");async function s(e){try{let t=(0,i.apiClient).get(`/student_files/session/${e}`);return await t.fetch()}catch(e){throw console.error("Error fetching files for student:",e),e}}async function a(e){let t=new URLSearchParams(window.location.search).get("session");if(!t){console.error("No student ID provided in URL");return}let o=new n.WFDynamicList(e,{rowSelector:"#fileCard",loaderSelector:"#filesloading",emptySelector:"#filesEmpty"});o.loaderRenderer(e=>(e.setStyle({display:"flex"}),e)),o.emptyRenderer(e=>(e.setStyle({display:"flex"}),e)),o.rowRenderer(({rowData:e,rowElement:t})=>{let o=new n.WFComponent(t);return o.setAttribute("href",e.file_url),o.getChildAsComponent("#fileName").setText(e.file_name),t.setStyle({display:"block"}),t});try{o.changeLoadingStatus(!0);let e=await s(t);e.sort((e,t)=>e.file_name.localeCompare(t.file_name)),o.setData(e),o.changeLoadingStatus(!1)}catch(e){console.error("Error loading files:",e),o.setData([]),o.changeLoadingStatus(!1)}}},{"@xatom/core":"65YBq","../../../../api/apiConfig":"dUmIV","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}]},[],0,"parcelRequired346");
//# sourceMappingURL=sessionDetails.0afc2615.js.map
