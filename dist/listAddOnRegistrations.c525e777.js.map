{"mappings":"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","sources":["src/modules/dashboard/listAddOnRegistrations.ts","node_modules/.pnpm/@xatom+image@1.0.0_@xatom+core@1.0.12/node_modules/@xatom/image/dist/index.js"],"sourcesContent":["// src/pages/listAddOnRegistrations.ts\n\nimport { WFDynamicList, WFComponent } from \"@xatom/core\";\nimport { WFImage } from \"@xatom/image\";\nimport { apiClient } from \"../../api/apiConfig\";\n\n// ---------- Types ----------\ninterface ProgramDetails {\n  id: number;\n  name: string;\n  slug?: string;\n  Main_Image?: string | null;\n}\n\ninterface SessionRegistration {\n  id: number;\n  status: string;              // \"Active\", etc.\n  update_status: string;\n  student_id: number;\n  program_name: string;        // e.g. \"Labs\"\n  workshop_name: string;       // e.g. \"Dance Lab\"\n  weekday: string | null;\n  time_block: string | null;\n  location: string | null;\n  parent_user_id: number;\n  subscription_id: number;     // 0 for add-ons\n  program_id: number;          // <— used for grouping\n  workshop_id: number;\n  session_id: number;\n  location_id: number;\n  created_at: number;          // ms\n  move_to: number;\n  product_id: number;\n  update_product_id: number;\n  cancellation_reason: string;\n  cancelled_at: number | null;\n  checkout_session_id: string;\n  program_details?: ProgramDetails;\n}\n\ntype SessionRegistrationsApi =\n  | SessionRegistration[]\n  | { data: SessionRegistration[] }; // handle both shapes defensively\n\n// ---------- API ----------\nexport async function fetchAddOnRegistrations(): Promise<SessionRegistration[]> {\n  const req = apiClient.get<SessionRegistrationsApi>(\"/session_registrations\");\n  const res = await req.fetch();\n\n  // Normalize to a plain array either way\n  const arr = Array.isArray(res) ? res : res?.data;\n  return Array.isArray(arr) ? arr : [];\n}\n\n// ---------- List Init ----------\n/**\n * Initialize the Add-On Registrations list.\n * HTML structure expected:\n *\n * div#listAddOnRegistration\n *   ├─ a#listAddOnRegistrationCard (template row)\n *   ├─ div#listAddOnRegistrationloading\n *   └─ div#listAddOnRegistrationEmpty\n */\nexport async function initializeDynamicAddOnRegistrationList(\n  containerSelector: string = \"#listAddOnRegistration\"\n) {\n  const list = new WFDynamicList<SessionRegistration>(containerSelector, {\n    rowSelector: \"#listAddOnRegistrationCard\",\n    loaderSelector: \"#listAddOnRegistrationloading\",\n    emptySelector: \"#listAddOnRegistrationEmpty\",\n  });\n\n  // Loader / Empty renderers\n  list.loaderRenderer((el) => {\n    el.setStyle({ display: \"flex\" });\n    return el;\n  });\n  list.emptyRenderer((el) => {\n    el.setStyle({ display: \"flex\" });\n    return el;\n  });\n\n  // Card renderer\n  list.rowRenderer(({ rowData, rowElement }) => {\n    const card = new WFComponent(rowElement);\n\n    // Image\n    const imgComp = card.getChildAsComponent<HTMLImageElement>(\"#cardAddOnRegistrationImage\");\n    if (imgComp) {\n      const wfImg = new WFImage(imgComp.getElement());\n      const src =\n        rowData.program_details?.Main_Image ||\n        \"https://cdn.prod.website-files.com/66102236c16b61185de61fe3/66102236c16b61185de6204e_placeholder.svg\";\n      wfImg.setImage(src);\n      (wfImg.getElement() as HTMLImageElement).alt =\n        rowData.program_details?.name || rowData.program_name || \"Program\";\n    }\n\n    // Program name\n    card\n      .getChildAsComponent(\"#cardAddOnProgramName\")\n      ?.setText(rowData.program_details?.name || rowData.program_name || \"\");\n\n    // Link → /dashboard/registration/program?program={program_id}&subscription=none\n    const anchor = card.getElement() as HTMLAnchorElement;\n    const url = new URL(anchor.getAttribute(\"href\") || \"/dashboard/registration/program\", window.location.origin);\n    url.searchParams.set(\"program\", String(rowData.program_id));\n    url.searchParams.set(\"subscription\", \"none\");\n    anchor.setAttribute(\"href\", url.toString());\n\n    // Display the card\n    rowElement.setStyle({ display: \"block\" });\n    return rowElement;\n  });\n\n  // Load + render\n  list.changeLoadingStatus(true);\n  try {\n    const regs = await fetchAddOnRegistrations();\n\n    // Deduplicate to one card per program_id (same idea as subscriptions)\n    const uniqueByProgram = Array.from(\n      regs.reduce<Map<number, SessionRegistration>>((map, reg) => {\n        if (!map.has(reg.program_id)) map.set(reg.program_id, reg);\n        return map;\n      }, new Map()).values()\n    );\n\n    // Sort by program name (fallback to program_name)\n    uniqueByProgram.sort((a, b) => {\n      const an = a.program_details?.name || a.program_name || \"\";\n      const bn = b.program_details?.name || b.program_name || \"\";\n      return an.localeCompare(bn);\n    });\n\n    list.setData(uniqueByProgram);\n  } catch (err) {\n    console.error(\"Error loading add-on registrations:\", err);\n    list.setData([]);\n  } finally {\n    list.changeLoadingStatus(false);\n  }\n}\n\n// Optional: auto-init on DOM ready for the provided HTML block\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  // Only init if the container exists on this page\n  if (document.querySelector(\"#listAddOnRegistration\")) {\n    initializeDynamicAddOnRegistrationList(\"#listAddOnRegistration\");\n  }\n});\n","var t=require(\"@xatom/core\");var e,r,s,i,o,n,u={};e=u,r=\"WFImage\",s=()=>c,Object.defineProperty(e,r,{get:s,set:i,enumerable:!0,configurable:!0});class c extends t.WFComponent{constructor(t){super(t)}getImageConfig(){return this._config}getSrc(){return this.getAttribute(\"src\")}getSizes(){return this.getAttribute(\"sizes\")}getSrcSet(){return this.getAttribute(\"srcset\")}getLoading(){return this.getAttribute(\"loading\")}onLoad(t){return this.on(\"load\",t),()=>{this.off(\"load\",t)}}onLoadError(t){return this.on(\"error\",t),()=>{this.off(\"error\",t)}}setImage(t){if(\"string\"==typeof t)this.setAttribute(\"src\",t),this.removeAttribute(\"srcset\"),this.removeAttribute(\"sizes\");else{if(this.setAttribute(\"src\",t.src),\"object\"==typeof t&&t.srcSet&&t.srcSet.length&&t.sizes&&t.sizes.length){const e=t.srcSet.map((t=>`${t.url} ${t.size}`)).join(\", \");this.setAttribute(\"srcset\",e)}else this.removeAttribute(\"srcset\"),this.removeAttribute(\"sizes\");t.loading&&this.setAttribute(\"loading\",t.loading)}}}o=module.exports,n=u,Object.keys(n).forEach((function(t){\"default\"===t||\"__esModule\"===t||o.hasOwnProperty(t)||Object.defineProperty(o,t,{enumerable:!0,get:function(){return n[t]}})}));"],"names":[],"version":3,"file":"listAddOnRegistrations.c525e777.js.map","sourceRoot":"../"}