!function(e,t,n,o,i){var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s="function"==typeof r[o]&&r[o],l=s.cache||{},a="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function d(t,n){if(!l[t]){if(!e[t]){var i="function"==typeof r[o]&&r[o];if(!n&&i)return i(t,!0);if(s)return s(t,!0);if(a&&"string"==typeof t)return a(t);var c=Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(n){var o=e[t][1][n];return null!=o?o:n},p.cache={};var u=l[t]=new d.Module(t);e[t][0].call(u.exports,p,u,u.exports,this)}return l[t].exports;function p(e){var t=p.resolve(e);return!1===t?{}:d(t)}}d.isParcelRequire=!0,d.Module=function(e){this.id=e,this.bundle=d,this.exports={}},d.modules=e,d.cache=l,d.parent=s,d.register=function(t,n){e[t]=[function(e,t){t.exports=n},{}]},Object.defineProperty(d,"root",{get:function(){return r[o]}}),r[o]=d;for(var c=0;c<t.length;c++)d(t[c])}({bv7hf:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"newProgramRegistration",()=>f);var i=e("../../api/startLabRegistration"),r=e("./components/dynamicRegistrationTable"),s=e("./components/checkoutLineItems"),l=e("./components/financialAid"),a=e("./state/registrationState"),d=e("./components/pendingStudentsAlert"),c=e("./components/checkoutSubmission"),u=e("./components/loadRegistrationUI"),p=e("@xatom/core"),m=e("./components/actionRequiredDialog"),g=e("./components/deleteOrderURLParam");async function f(){console.log("new registration"),await (0,g.initializeDeleteOrderFromUrl)();try{let t=await (0,i.startRegistration)({});console.log("Registration started:",t),(0,a.saveState)({apiData:t}),(0,r.initDynamicRegistrationTable)(t,{tableBodySelector:"#subscription_items_list",emptyStateSelector:"#subscription_empty",templateRowSelector:"#subscription_item",addButtonSelector:"#subscription_items_table tfoot #add_subscription_item",isAddOn:!0,fields:{program:{textSelector:"#item_program_name",selectSelector:"#program-select-1"},workshop:{textSelector:"#item_workshop_name",selectSelector:"#workshop-select-1"},session:{textSelector:"#item_session_name",selectSelector:"#session-select-1"},student:{textSelector:"#item_student_name",selectSelector:"#student-select-1"}}});let n=(0,a.loadState)();n.registrationItems&&n.registrationItems.length>0&&(0,u.loadRegistrationUI)();let o=document.getElementById("subscription_type");o&&n.subscriptionType&&(o.value=n.subscriptionType),(0,s.updateCheckoutLineItems)(t),(0,d.updatePendingStudentsAlert)(t),(0,m.showActionRequiredDialogIfNoStudentProfiles)(t);let l=document.querySelector(".success_trigger");function e(){let e=document.querySelectorAll("#subscription_items_list tr.confirmed"),t=document.getElementById("submit_registration_checkout");0===e.length?t.disabled=!0:t.disabled=!1}l&&l.click(),e(),document.addEventListener("registrationChanged",()=>{(0,s.updateCheckoutLineItems)(t),(0,d.updatePendingStudentsAlert)(t),e()}),o&&o.addEventListener("change",()=>{(0,a.saveState)({subscriptionType:o.value}),(0,s.updateCheckoutLineItems)(t)});let g=new p.WFComponent("#submit_registration_checkout");g.on("click",async e=>{e.preventDefault();let t=g.getElement();if(t.disabled)return;t.disabled=!0;let n=document.getElementById("submit_registration_checkout_animation");n&&(n.style.display="block");try{await (0,c.submitCheckout)()}catch(e){console.error(e)}finally{n&&(n.style.display="none"),t.disabled=!1}})}catch(e){console.error("Error starting registration:",e)}(0,l.initializeFinancialAid)()}},{"../../api/startLabRegistration":"01wbL","./components/dynamicRegistrationTable":"kOPn4","./components/checkoutLineItems":"fvfZJ","./components/financialAid":"hLqRq","./state/registrationState":"l8dn0","./components/pendingStudentsAlert":"3qVBD","./components/checkoutSubmission":"l1y74","./components/loadRegistrationUI":"dVBaH","@xatom/core":"65YBq","./components/actionRequiredDialog":"bw30W","./components/deleteOrderURLParam":"7zO3n","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"01wbL":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"startRegistration",()=>r);var i=e("./apiConfig");async function r(e){try{return await (0,i.apiClient).post("/registration/start_lab_registration",e).fetch()}catch(e){throw console.error("Error starting registration:",e),e}}},{"./apiConfig":"dUmIV","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],kOPn4:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"initDynamicRegistrationTable",()=>s),o.export(n,"attachRowEventListeners",()=>d),o.export(n,"populateProgramOptions",()=>l);var i=e("@xatom/core"),r=e("../state/registrationState");function s(e,t){let n=new i.WFComponent(t.tableBodySelector),o=new i.WFComponent(t.emptyStateSelector),r=new i.WFComponent(t.addButtonSelector),s=document.querySelector(t.templateRowSelector);if(!s){console.error("Template row not found with selector:",t.templateRowSelector);return}s.style.display="none",r.on("click",()=>{o.getElement().style.display="none";let r=s.cloneNode(!0);r.removeAttribute("id"),r.style.display="table-row";let a=new i.WFComponent(r);[{field:"program",enable:!0},{field:"workshop",enable:!1},{field:"session",enable:!1},{field:"student",enable:!1}].forEach(e=>{let n=a.getChildAsComponent(t.fields[e.field].textSelector),o=a.getChildAsComponent(t.fields[e.field].selectSelector);n.getElement().style.display="none",o.getElement().style.display="block",o.getElement().disabled=!e.enable}),a.removeCssClass("confirmed"),n.appendChild(a),l(a,e,t),d(a,e,t)})}function l(e,t,n){let o=e.getChildAsComponent(n.fields.program.selectSelector);o.getElement().disabled=!1;let i=new Map;t.sessions.forEach(e=>{e.program.Add_On_Program===n.isAddOn&&i.set(e.program.id,e.program.name)});let r='<option value="">Select Program</option>';i.forEach((e,t)=>{r+=`<option value="${t}">${e}</option>`}),o.setHTML(r)}function a(e,t,n,o,i){let r=e.getChildAsComponent(i.fields.session.selectSelector);r.getElement().disabled=!1;let s=t.sessions.filter(e=>e.program.id.toString()===n);o&&(s=s.filter(e=>e.workshop&&e.workshop.id.toString()===o));let l='<option value="">Select Session</option>';s.forEach(e=>{let t=`${e.Weekday} ${e.Time_block}`;l+=`<option value="${e.id}">${t}</option>`}),r.setHTML(l)}function d(e,t,n){let o=e.getChildAsComponent(n.fields.program.selectSelector);o.on("change",()=>{let i=o.getElement().value;e.getElement().setAttribute("data-program-id",i),function(e,t,n,o){let i=e.getChildAsComponent(o.fields.workshop.selectSelector),r=t.sessions.filter(e=>e.program.id.toString()===n&&e.workshop);if(r.length>0){i.getElement().disabled=!1;let t='<option value="">Select Workshop</option>',n=new Map;r.forEach(e=>{e.workshop&&n.set(e.workshop.id,e.workshop.Name)}),Array.from(n.entries()).sort((e,t)=>e[1].localeCompare(t[1])).forEach(([e,n])=>{t+=`<option value="${e}">${n}</option>`}),i.setHTML(t),i.getElement().style.display="block",e.getChildAsComponent(o.fields.workshop.textSelector).getElement().style.display="none"}else{i.getElement().disabled=!0,i.getElement().style.display="none";let r=e.getChildAsComponent(o.fields.workshop.textSelector);r.setText(" - "),r.getElement().style.display="block",a(e,t,n,null,o)}}(e,t,i,n),e.getChildAsComponent(n.fields.session.selectSelector).getElement().disabled=!1});let i=e.getChildAsComponent(n.fields.workshop.selectSelector);i.on("change",()=>{let o=i.getElement().value;e.getElement().setAttribute("data-workshop-id",o);let r=e.getElement().getAttribute("data-program-id")||"";a(e,t,r,o,n)});let s=e.getChildAsComponent(n.fields.session.selectSelector);s.on("change",()=>{let o=s.getElement().value;e.getElement().setAttribute("data-session-id",o),e.getChildAsComponent(n.fields.student.selectSelector).getElement().disabled=!1,function(e,t,n){let o=e.getChildAsComponent(n.fields.student.selectSelector);o.getElement().disabled=!1;let i='<option value="">Select Student</option>',r=e.getElement().getAttribute("data-session-id"),s=document.querySelector(n.tableBodySelector),l=[];s&&r&&Array.from(s.querySelectorAll("tr.confirmed")).forEach(e=>{if(e.getAttribute("data-session-id")===r){let t=e.getAttribute("data-student-id");t&&l.push(t)}}),t.student_profiles.forEach(e=>{l.includes(e.id.toString())||(i+=`<option value="${e.id}">${e.full_name}</option>`)}),o.setHTML(i)}(e,t,n)}),e.getChildAsComponent(n.fields.student.selectSelector).on("change",()=>{let o=e.getChildAsComponent(n.fields.program.selectSelector).getElement(),i=e.getChildAsComponent(n.fields.workshop.selectSelector).getElement(),s=e.getChildAsComponent(n.fields.session.selectSelector).getElement(),l=e.getChildAsComponent(n.fields.student.selectSelector).getElement(),a=o.value,d=i.disabled?null:i.value,c=s.value,u=l.value;if(!a||!c||!u)return;let p=e.getElement();p.setAttribute("data-program-id",a),p.setAttribute("data-session-id",c),p.setAttribute("data-student-id",u),d&&p.setAttribute("data-workshop-id",d);let m=document.querySelector(n.tableBodySelector);if(m&&Array.from(m.querySelectorAll("tr.confirmed")).some(e=>e.getAttribute("data-session-id")===c&&e.getAttribute("data-student-id")===u)){console.warn("This student is already registered for the selected session.");return}let g=e.getChildAsComponent(n.fields.program.textSelector);g.setText(o.options[o.selectedIndex].text);let f=e.getChildAsComponent(n.fields.workshop.textSelector);f.setText(i.disabled?" - ":i.options[i.selectedIndex].text);let h=e.getChildAsComponent(n.fields.session.textSelector),y=t.sessions.find(e=>e.id.toString()===c);h.setText(y?`${y.Weekday} ${y.Time_block}`:"Unknown session");let _=e.getChildAsComponent(n.fields.student.textSelector);_.setText(l.options[l.selectedIndex].text),[n.fields.program,n.fields.workshop,n.fields.session,n.fields.student].forEach(t=>{let n=e.getChildAsComponent(t.selectSelector).getElement().parentElement;n&&(n.style.display="none"),e.getChildAsComponent(t.textSelector).getElement().style.display="block"}),e.addCssClass("confirmed");let S=(0,r.loadState)().registrationItems||[],b={program_id:a,session_id:c,student_id:u,program_name:g.getElement().textContent||"",workshop_name:f.getElement().textContent||"",session_name:h.getElement().textContent||"",student_name:_.getElement().textContent||""};(0,r.saveState)({registrationItems:[...S,b]}),document.dispatchEvent(new CustomEvent("registrationChanged"))}),e.getChildAsComponent(".remove_registration_button").on("click",()=>{e.remove();let t=document.querySelector(n.tableBodySelector);if(t){let e=n.templateRowSelector.startsWith("#")?n.templateRowSelector.slice(1):n.templateRowSelector,o=n.emptyStateSelector.startsWith("#")?n.emptyStateSelector.slice(1):n.emptyStateSelector;if(0===Array.from(t.querySelectorAll("tr")).filter(t=>t.id!==e&&t.id!==o).length){let e=document.querySelector(n.emptyStateSelector);e&&(e.style.display="table-row")}}let o=((0,r.loadState)().registrationItems||[]).filter(t=>!(t.session_id===e.getAttribute("data-session-id")&&t.student_id===e.getAttribute("data-student-id")));(0,r.saveState)({registrationItems:o}),document.dispatchEvent(new CustomEvent("registrationChanged"))})}},{"@xatom/core":"65YBq","../state/registrationState":"l8dn0","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],l8dn0:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"loadState",()=>s),o.export(n,"saveState",()=>l),o.export(n,"resetRegistrationState",()=>a);let i="labRegistrationState",r=function(){try{let e=localStorage.getItem(i);return e?JSON.parse(e):null}catch(e){return console.error("Error loading state from storage:",e),null}}()||{fin_aid_requested:!1,selected_discount:void 0,financialAidData:void 0,subscriptionType:"year",apiData:void 0,originalSubscriptionTotal:0,registrationItems:[]};function s(){return r}function l(e){d(r={...r,...e})}function a(){d(r={fin_aid_requested:!1,selected_discount:void 0,financialAidData:void 0,subscriptionType:"year",apiData:void 0,originalSubscriptionTotal:0,registrationItems:[]})}function d(e){try{localStorage.setItem(i,JSON.stringify(e))}catch(e){console.error("Error saving state to storage:",e)}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],fvfZJ:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"updateCheckoutLineItems",()=>l);var i=e("@xatom/core"),r=e("../state/registrationState"),s=e("./updateTotalAmount");function l(e){console.log("[DEBUG] updateCheckoutLineItems (SINGLE-SALE MODE): start");let t=document.querySelectorAll("#subscription_items_list tr.confirmed");console.log("[DEBUG] updateCheckoutLineItems: Found",t.length,"confirmed rows.");let n=[];t.forEach((t,o)=>{let i=t.getAttribute("data-session-id");if(console.log(`[DEBUG] updateCheckoutLineItems: Processing row ${o+1}, session id:`,i),!i)return;let r=function(e,t){let n=e.find(e=>e.id.toString()===t);return console.log(`[DEBUG] getSessionById: Looking for session id ${t}:`,n),n}(e.sessions,i);if(!r)return;let s=parseFloat((r.tuition_product.Displayed_single_sale_price||"").replace(/[^0-9\.]/g,""))||0;n.push({productName:r.Name,quantity:1,unitPrice:s,total:s})}),console.log("[DEBUG] updateCheckoutLineItems: Items before grouping:",n);let o=function(e){let t=new Map;e.forEach(e=>{let n=e.productName;if(t.has(n)){let o=t.get(n);o.quantity+=e.quantity,o.total+=e.total,t.set(n,o)}else t.set(n,{...e})});let n=Array.from(t.values());return console.log("[DEBUG] groupLineItems: Final grouped items:",n),n}(n),l="";o.forEach((e,t)=>{l+=`
      <div class="line_item u-hflex-left-center u-text-small">
        <div id="subscription_item_product" class="text-weight-bold line_item_product">${e.productName}</div>
        <div id="subscription_item_unit_amount" class="line_item_unit_amount">$${e.unitPrice.toFixed(2)}</div>
        <div>x</div>
        <div id="subscription_item_quantity" class="line_item_quantity">${e.quantity}</div>
        <div id="subscription_item_total" class="line_item_total text-weight-bold">$${e.total.toFixed(2)}</div>
      </div>
    `,console.log(`[DEBUG] updateCheckoutLineItems: Built line item ${t+1}:`,e)}),new(0,i.WFComponent)("#subscription_line_items_list").setHTML(l);let a=new i.WFComponent("#subscription_line_items_wrap"),d=new i.WFComponent("#subscription_line_items_empty");o.length>0?(a.getElement().style.display="flex",d.getElement().style.display="none"):(a.getElement().style.display="none",d.getElement().style.display="block");let c=o.reduce((e,t)=>e+t.total,0);console.log("[DEBUG] updateCheckoutLineItems: Subtotal (single-sale) =",c),(0,r.saveState)({originalSubscriptionTotal:c}),(0,s.updateTotalAmount)(!1,void 0,0);let u=document.getElementById("deposit_line_items_container");u&&(u.style.display="none");let p=document.getElementById("alertBoxEarly");p&&(p.style.display="none"),console.log("[DEBUG] updateCheckoutLineItems (SINGLE-SALE MODE): done")}},{"@xatom/core":"65YBq","../state/registrationState":"l8dn0","./updateTotalAmount":"jL1LL","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],jL1LL:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"updateTotalAmount",()=>s);var i=e("@xatom/core"),r=e("../state/registrationState");function s(e,t,n=0){let o=(0,r.loadState)(),s=o.originalSubscriptionTotal||0,l=o.selected_discount?parseFloat(o.selected_discount):0,a=s-l/100*s,d=t?"/"+t:"";new i.WFComponent("#subscription_discount_pill").getElement().style.display=l>0?"block":"none",new i.WFComponent("#subscription_discount_applied").setText(l>0?`${l}%`:"");let c=new i.WFComponent("#subscription_original_amount");l>0?(c.setText(`was $${s.toFixed(2)} ${d}`),c.getElement().style.display="block"):c.getElement().style.display="none",new i.WFComponent("#subscription_total").setText(`$${a.toFixed(2)} ${d}`),new i.WFComponent("#total_amount_due").setText(`$${(n>0?n:a).toFixed(2)}`)}},{"@xatom/core":"65YBq","../state/registrationState":"l8dn0","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],hLqRq:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"initializeFinancialAid",()=>a),o.export(n,"saveFinancialAidData",()=>p),o.export(n,"loadFinancialAidData",()=>d);var i=e("@xatom/core"),r=e("../state/registrationState"),s=e("../../../utils/formUtils"),l=e("../../../utils/validationUtils");let a=()=>{d();let e=new i.WFComponent("#requestFinAid"),t=new i.WFComponent("#finaidForm");e.on("change",()=>{e.getElement().checked?t.getElement().showModal():((0,r.saveState)({fin_aid_requested:!1,selected_discount:void 0}),document.dispatchEvent(new CustomEvent("registrationChanged")))}),t.getElement()?.addEventListener("close",()=>{r.loadState().selected_discount||(e.getElement().checked=!1)}),c(),new i.WFComponent("#submitfinancialAid").on("click",()=>{u()&&(p(),m())}),f(t);let n=new i.WFComponent("#annualIncome"),o=new i.WFComponent("#monthlyExpense"),s=e=>{let t=e.getElement(),n=t.value.replace(/[^\d.-]/g,""),o=t.selectionStart||0,i=(t.value.slice(0,o).match(/,/g)||[]).length;if(n.includes(".")){let[e,t]=n.split(".");n=`${e}.${t.slice(0,2)}`}let r=l(n);t.value=r;let s=(r.slice(0,o).match(/,/g)||[]).length;(o+=s-i)>r.length&&(o=r.length),t.setSelectionRange(o,o)},l=e=>{let t=parseFloat(e.replace(/,/g,""));return isNaN(t)?e:t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})};n.on("input",()=>s(n)),o.on("input",()=>s(o))};function d(){let e=(0,r.loadState)(),t=new i.WFComponent("#requestFinAid");if(e.fin_aid_requested&&e.financialAidData){t.getElement().checked=!0;let n=new i.WFComponent("#finaidRelationship"),o=new i.WFComponent("#annualIncome"),r=new i.WFComponent("#monthlyExpense"),s=e.financialAidData.previousParticipant,l=document.getElementsByName("previous_participant");n.getElement().value=e.financialAidData.relationship||"",o.getElement().value=e.financialAidData.annualIncome||"",r.getElement().value=e.financialAidData.monthlyExpense||"",l.forEach(e=>{e.checked=e.value===s}),console.log("[DEBUG] loadFinancialAidData: Financial aid data loaded from state.")}else t.getElement().checked=!1}let c=()=>{let e=new i.WFComponent("#finaidRelationship"),t=new i.WFComponent("#finaidRelationshipError"),n=document.getElementsByName("previous_participant"),o=new i.WFComponent("#previousParticipantError"),r=new i.WFComponent("#annualIncome"),a=new i.WFComponent("#annualIncomeError"),d=new i.WFComponent("#monthlyExpense"),c=new i.WFComponent("#monthlyExpenseError");(0,s.setupValidation)(e,t,()=>(0,l.validateSelectField)(h(e))?"":"Please select a relationship."),(0,s.setupValidation)(r,a,()=>(0,l.validateNotEmpty)(h(r))?"":"Please enter your annual household income."),(0,s.setupValidation)(d,c,()=>(0,l.validateNotEmpty)(h(d))?"":"Please enter your monthly expenditure."),Array.from(n).forEach(e=>{(0,s.setupValidation)(new i.WFComponent(e),o,()=>Array.from(n).some(e=>e.checked)?"":"Please select an option.")})},u=()=>{let e=new i.WFComponent("#finaidRelationship"),t=new i.WFComponent("#annualIncome"),n=new i.WFComponent("#monthlyExpense"),o=document.getElementsByName("previous_participant"),r=(0,l.validateSelectField)(h(e));(0,s.toggleError)(new i.WFComponent("#finaidRelationshipError"),"Please select a relationship.",!r);let a=(0,l.validateNotEmpty)(h(t));(0,s.toggleError)(new i.WFComponent("#annualIncomeError"),"Please enter your annual household income.",!a);let d=(0,l.validateNotEmpty)(h(n));(0,s.toggleError)(new i.WFComponent("#monthlyExpenseError"),"Please enter your monthly expenditure.",!d);let c=Array.from(o).some(e=>e.checked);return(0,s.toggleError)(new i.WFComponent("#previousParticipantError"),"Please select an option.",!c),r&&a&&d&&c},p=()=>{let e=new(0,i.WFComponent)("#finaidRelationship").getElement().value,t=new(0,i.WFComponent)("#annualIncome").getElement().value,n=new(0,i.WFComponent)("#monthlyExpense").getElement().value,o=document.querySelector("input[name='previous_participant']:checked"),s=o?o.value:"";(0,r.saveState)({fin_aid_requested:!0,selected_discount:"",financialAidData:{relationship:e,annualIncome:t,monthlyExpense:n,previousParticipant:s}}),console.log("[DEBUG] saveFinancialAidData: Financial aid data saved:",{relationship:e,annualIncome:t,monthlyExpense:n,previousParticipant:s})},m=()=>{let e=new i.WFComponent(".success-message"),t=new i.WFComponent("#wf-form-Finaid-Form");t.setStyle({display:"none"}),e.setStyle({display:"block"});let n=new i.WFComponent("#applyDiscount"),o=new i.WFComponent("#backFinAid"),s=new i.WFComponent("#finaidForm");n.on("click",()=>{let e=document.querySelector("input[name='discountValue']:checked");if(e){let t=e.value;(0,r.saveState)({selected_discount:t,fin_aid_requested:!0}),document.dispatchEvent(new CustomEvent("registrationChanged")),g(s)}else console.warn("No discount selected.")}),o.on("click",()=>{e.setStyle({display:"none"}),t.setStyle({display:"flex"})})},g=e=>{e.getElement().close()},f=e=>{new i.WFComponent("#close-dialog-btn").on("click",()=>g(e)),e.getElement()?.addEventListener("click",t=>{let n=e.getElement().getBoundingClientRect();(t.clientX<n.left||t.clientX>n.right||t.clientY<n.top||t.clientY>n.bottom)&&g(e)})},h=e=>e.getElement().value},{"@xatom/core":"65YBq","../state/registrationState":"l8dn0","../../../utils/formUtils":"gepHz","../../../utils/validationUtils":"gu2z7","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],gepHz:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"toggleError",()=>a),o.export(n,"setupValidation",()=>d),o.export(n,"createValidationFunction",()=>c),o.export(n,"createCheckboxValidationFunction",()=>u),o.export(n,"setupCheckboxValidation",()=>p),o.export(n,"validateSelectedSessions",()=>m),o.export(n,"setProfilePicUrl",()=>g),o.export(n,"setupFileUpload",()=>f),o.export(n,"formatPhoneNumber",()=>h);var i=e("@xatom/core"),r=e("@xatom/image"),s=e("../api/apiConfig"),l=e("../auth/authConfig");function a(e,t,n){e.updateTextViaAttrVar({text:n?t:""}),e.setStyle({display:n?"flex":"none"})}function d(e,t,n,o){let i=()=>{let e=n();a(t,e,!!e),o&&""===e&&a(o,"",!1)};e.on("input",i),e.on("blur",i),e.on("change",i)}function c(e,t,n){return()=>t(e.getElement().value)?"":n}function u(e,t){return()=>e.getElement().checked?"":t}function p(e,t,n){let o=u(e,n);d(e,t,o)}function m(e,t,n){let o=e.length>0&&e.some(e=>e.studentIds.length>0);return o?a(t,"",!1):a(t,n,!0),o}function g(e){let t=(0,l.userAuth).getUser();t&&t.profile&&(t.profile.profile_pic=t.profile.profile_pic||{url:""},t.profile.profile_pic.url=e,(0,l.userAuth).setUser(t),localStorage.setItem("auth_user",JSON.stringify(t)))}function f(e,t,n,o){let l=new r.WFImage("#profilePictureImage"),d=new i.WFComponent("#uploadAnimation"),c=new i.WFComponent(".drop-zone"),u=0;return new Promise(i=>{let r=r=>{if(!["image/jpeg","image/jpg"].includes(r.type)&&!/\.(jpg|jpeg)$/i.test(r.name)){a(t,"Only JPEG images are allowed.",!0),e.getElement().value="";return}if(r.size>2097152){a(t,"File size must be less than 2 MB.",!0),e.getElement().value="";return}d.setStyle({display:"flex"}),t.setStyle({display:"none"}),n.setStyle({display:"none"});let p=new FileReader;p.onload=e=>{let t=e.target?.result;l.setImage(t),c.setStyle({display:"none"})},p.readAsDataURL(r);let m=new FormData;m.append("profile_picture",r);let f=localStorage.getItem("current_student");if(f){let e=JSON.parse(f);m.append("student_profile_id",e.id.toString())}let h=(0,s.apiClient).post(o,{data:m});h.onData(o=>{if("success"===o.status){let e=o.url.profile_pic.url;g(e),l.setImage(e),localStorage.setItem("image_upload",e),n.setStyle({display:"flex"}),d.setStyle({display:"none"}),i(e)}else a(t,"Failed to upload profile picture.",!0),d.setStyle({display:"none"}),c.setStyle({display:"none"}),u=0,e.getElement().value=""}),h.onError(n=>{let o="An error occurred during image upload.";n.response&&n.response.data?o=n.response.data.message||o:n.message&&(o=n.message),a(t,o,!0),d.setStyle({display:"none"}),c.setStyle({display:"none"}),u=0,e.getElement().value=""}),h.fetch()};e.on("change",()=>{let t=e.getElement().files?.[0];t&&r(t)});let p=document.body;p.addEventListener("dragenter",e=>{e.preventDefault(),1==++u&&c.setStyle({display:"flex"})}),p.addEventListener("dragleave",()=>{--u<=0&&(c.setStyle({display:"none"}),u=0)}),p.addEventListener("dragover",e=>{e.preventDefault()}),p.addEventListener("drop",e=>{e.preventDefault();let t=e.dataTransfer?.files;t?.length&&r(t[0]),c.setStyle({display:"none"}),u=0})})}let h=e=>{let t=e.replace(/\D/g,"");return t.length<=3?t:t.length<=6?`(${t.slice(0,3)}) ${t.slice(3)}`:t.length<=10?`(${t.slice(0,3)}) ${t.slice(3,6)}-${t.slice(6)}`:`(${t.slice(0,3)}) ${t.slice(3,6)}-${t.slice(6,10)}`}},{"@xatom/core":"65YBq","@xatom/image":"bavwf","../api/apiConfig":"dUmIV","../auth/authConfig":"dHwPR","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],bavwf:[function(e,t,n){var o,i=e("d023971cccd819e3"),r={};Object.defineProperty(r,"WFImage",{get:()=>s,set:void 0,enumerable:!0,configurable:!0});class s extends i.WFComponent{constructor(e){super(e)}getImageConfig(){return this._config}getSrc(){return this.getAttribute("src")}getSizes(){return this.getAttribute("sizes")}getSrcSet(){return this.getAttribute("srcset")}getLoading(){return this.getAttribute("loading")}onLoad(e){return this.on("load",e),()=>{this.off("load",e)}}onLoadError(e){return this.on("error",e),()=>{this.off("error",e)}}setImage(e){if("string"==typeof e)this.setAttribute("src",e),this.removeAttribute("srcset"),this.removeAttribute("sizes");else{if(this.setAttribute("src",e.src),"object"==typeof e&&e.srcSet&&e.srcSet.length&&e.sizes&&e.sizes.length){let t=e.srcSet.map(e=>`${e.url} ${e.size}`).join(", ");this.setAttribute("srcset",t)}else this.removeAttribute("srcset"),this.removeAttribute("sizes");e.loading&&this.setAttribute("loading",e.loading)}}}o=t.exports,Object.keys(r).forEach(function(e){"default"===e||"__esModule"===e||o.hasOwnProperty(e)||Object.defineProperty(o,e,{enumerable:!0,get:function(){return r[e]}})})},{d023971cccd819e3:"65YBq"}],gu2z7:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");function i(e){return void 0!==e&&""!==e.trim()}function r(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}o.defineInteropFlag(n),o.export(n,"validateNotEmpty",()=>i),o.export(n,"validateEmail",()=>r),o.export(n,"validateEmailOptional",()=>s),o.export(n,"validatePasswordRequirements",()=>l),o.export(n,"validateCheckbox",()=>a),o.export(n,"validatePasswordsMatch",()=>d),o.export(n,"validateSelectField",()=>c),o.export(n,"validatePhoneNumber",()=>u),o.export(n,"validatePhoneNumberOptional",()=>p);let s=e=>""===e.trim()||r(e);function l(e){let t=/[a-z]/.test(e),n=/[A-Z]/.test(e),o=/\d/.test(e),i=/[!@#$%^&*(),.?":{}|<>]/.test(e),r=e.length>=8;return t&&n&&o&&i&&r}function a(e){return e}function d(e,t){return e===t}function c(e){return void 0!==e&&"N/A"!==e}function u(e){return/^\(\d{3}\)\s\d{3}-\d{4}$/.test(e)}let p=e=>""===e.trim()||u(e)},{"@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"3qVBD":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"updatePendingStudentsAlert",()=>r);var i=e("@xatom/core");function r(e){let t=new i.WFComponent("#alertBox"),n=new i.WFComponent("#alertPendingStudentList");if(e.student_profiles&&Array.isArray(e.student_profiles)){let o=e.student_profiles.filter(e=>e.Status&&"pending"===e.Status.toLowerCase());if(o.length>0){let e=o.map(e=>e.full_name).join(", ");n.setText(e),t.getElement().style.display="flex";return}}t.getElement().style.display="none"}},{"@xatom/core":"65YBq","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],l1y74:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"submitCheckout",()=>a);var i=e("@xatom/core"),r=e("../state/registrationState"),s=e("../../../utils/formUtils"),l=e("../../../api/apiConfig");async function a(){let e=(0,r.loadState)();if(!e.apiData){console.error("No API data found in state."),d("No API data found in state.");return}let t=e.apiData,n=Array.from(document.querySelectorAll("#subscription_items_list tr.confirmed")),o=n.map(e=>({program_id:e.getAttribute("data-program-id"),session_id:e.getAttribute("data-session-id"),student_id:e.getAttribute("data-student-id")})),a=new Map;n.forEach(e=>{let n=e.getAttribute("data-session-id");if(!n)return;let o=function(e,t){let n=e.find(e=>e.id.toString()===t);return console.log(`[DEBUG] checkoutSubmission - getSessionById: Looking for session id ${t}:`,n),n}(t.sessions,n);if(!o)return;let i=o.tuition_product.Single_sale_price_id;if(!i)return;let r=a.get(i)||0;a.set(i,r+1)});let c=Array.from(a.entries()).map(([e,t])=>({price:e,quantity:t}));console.log("[DEBUG] submitCheckout: Subscription (single-sale) line items",c);let u=parseFloat((new(0,i.WFComponent)("#total_amount_due").getElement().textContent||"").replace(/[^0-9\.]/g,""))||0,p=e.originalSubscriptionTotal||0,m=(e.selected_discount?parseFloat(e.selected_discount):0)/100*p,g={registration_items:o,subscription_line_items:c,deposit_line_items:null,financial_aid:{requested:e.fin_aid_requested,selected_discount:e.selected_discount,data:e.financialAidData},subscription_type:void 0,early_registration:!1,earliest_start_date:null,subscription_subtotal:p,subscription_amount_discount:m,subscription_total:p-m,total_due:u,students_pending:!1,base_url:window.location.origin};console.log("[DEBUG] submitCheckout: Payload",g);try{let e=await (0,l.apiClient).post("/registration/checkout_labs",{data:g}).fetch();if(console.log("[DEBUG] submitCheckout: Response",e),e.url)(function(){let e=new i.WFComponent("#registration_checkout_error");(0,s.toggleError)(e,"",!1)})(),window.location.href=e.url;else throw Error("No checkout URL returned")}catch(e){console.error("Error submitting checkout",e),d(e.message||"An error occurred during checkout.")}}function d(e){let t=new i.WFComponent("#registration_checkout_error");(0,s.toggleError)(t,e,!0)}},{"@xatom/core":"65YBq","../state/registrationState":"l8dn0","../../../utils/formUtils":"gepHz","../../../api/apiConfig":"dUmIV","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],dVBaH:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"loadRegistrationUI",()=>r);var i=e("../state/registrationState");function r(){let e=(0,i.loadState)();if(!e.registrationItems||0===e.registrationItems.length){console.log("[DEBUG] loadRegistrationUI: No registration items to load.");return}let t=document.getElementById("subscription_items_list");if(!t){console.error("Table body not found.");return}let n=document.getElementById("subscription_item");if(!n){console.error("Template row not found.");return}n.style.display="none",Array.from(t.getElementsByTagName("tr")).forEach(e=>{"subscription_item"!==e.id&&e.remove()});let o=document.getElementById("subscription_empty");o&&(o.style.display="none"),e.registrationItems.forEach(e=>{let o=n.cloneNode(!0);o.removeAttribute("id"),o.classList.add("confirmed"),o.style.display="table-row",o.setAttribute("data-program-id",e.program_id||""),o.setAttribute("data-session-id",e.session_id||""),o.setAttribute("data-student-id",e.student_id||"");let r=o.querySelector("#item_program_name");r&&(r.textContent=e.program_name||"",r.style.display="block");let s=o.querySelector("#item_workshop_name");s&&(s.textContent=e.workshop_name||"",s.style.display="block");let l=o.querySelector("#item_session_name");l&&(l.textContent=e.session_name||"",l.style.display="block");let a=o.querySelector("#item_student_name");a&&(a.textContent=e.student_name||"",a.style.display="block"),o.querySelectorAll("select").forEach(e=>e.style.display="none");let d=o.querySelector(".add_registration_button");d&&(d.style.display="none");let c=o.querySelector(".remove_registration_button");c&&c.addEventListener("click",()=>{o.remove();let e=((0,i.loadState)().registrationItems||[]).filter(e=>!(e.session_id===o.getAttribute("data-session-id")&&e.student_id===o.getAttribute("data-student-id")));if((0,i.saveState)({registrationItems:e}),0===Array.from(t.getElementsByTagName("tr")).filter(e=>"subscription_item"!==e.id).length){let e=document.getElementById("subscription_empty");e&&(e.style.display="table-row")}document.dispatchEvent(new CustomEvent("registrationChanged"))}),t.appendChild(o)}),console.log("[DEBUG] loadRegistrationUI: UI reloaded from state.")}},{"../state/registrationState":"l8dn0","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],bw30W:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"showActionRequiredDialogIfNoStudentProfiles",()=>r);var i=e("@xatom/core");function r(e){if(!e.student_profiles||0===e.student_profiles.length){let e=new i.WFComponent("#actionRequiredDialog").getElement();e instanceof HTMLDialogElement?e.showModal():e.style.display="block";let t=document.getElementById("alertDialogAnimationTrigger");t&&t.click()}}},{"@xatom/core":"65YBq","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"7zO3n":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"initializeDeleteOrderFromUrl",()=>l);var i=e("../../../api/apiConfig");let r=()=>({sessionId:new URLSearchParams(window.location.search).get("session_id")}),s=e=>{let t=new URLSearchParams(window.location.search);t.delete(e);let n=window.location.pathname,o=t.toString();window.history.replaceState({},document.title,n+(o?`?${o}`:""))},l=async()=>{let{sessionId:e}=r();if(e)try{let t=(0,i.apiClient).delete(`/registration/cancel_order/${encodeURIComponent(e)}`);await new Promise((e,n)=>{t.onData(()=>{s("session_id"),e()}),t.onError(e=>n(e)),t.fetch()})}catch(t){console.error("Error canceling order with session_id:",e,t)}}},{"../../../api/apiConfig":"dUmIV","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}]},[],0,"parcelRequired346");
//# sourceMappingURL=registration_labs.b5368c1c.js.map
