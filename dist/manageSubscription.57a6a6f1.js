!function(e,t,n,o,r){var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i="function"==typeof a[o]&&a[o],s=i.cache||{},l="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function p(t,n){if(!s[t]){if(!e[t]){var r="function"==typeof a[o]&&a[o];if(!n&&r)return r(t,!0);if(i)return i(t,!0);if(l&&"string"==typeof t)return l(t);var c=Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}m.resolve=function(n){var o=e[t][1][n];return null!=o?o:n},m.cache={};var u=s[t]=new p.Module(t);e[t][0].call(u.exports,m,u,u.exports,this)}return s[t].exports;function m(e){var t=m.resolve(e);return!1===t?{}:p(t)}}p.isParcelRequire=!0,p.Module=function(e){this.id=e,this.bundle=p,this.exports={}},p.modules=e,p.cache=s,p.parent=i,p.register=function(t,n){e[t]=[function(e,t){t.exports=n},{}]},Object.defineProperty(p,"root",{get:function(){return a[o]}}),a[o]=p;for(var c=0;c<t.length;c++)p(t[c])}({iTZac:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"manageSubscriptionPage",()=>S),o.export(n,"renderAll",()=>b);var r=e("../../api/apiConfig"),a=e("@xatom/core"),i=e("./state/manageSubscriptionState"),s=e("./components/manageRegistrationTable"),l=e("./components/manageSubscriptionLineItems"),p=e("./components/manageSubscriptionSummary"),c=e("./components/manageDepositLineItems"),u=e("./components/manageAmountDue"),m=e("./components/managePendingStudentsAlert"),d=e("./components/manageTrialAlert"),y=e("./components/manageSubscriptionDetails"),g=e("./components/manageSubscriptionCancelDialog");let f={tableBodySelector:"#subscription_items_list",templateRowSelector:"#subscription_item",emptyStateSelector:"#subscription_empty"};async function S(){let e=await (0,r.apiClient).post("/subscriptions/manage-subscription").fetch(),t=e.update_subscription_type||e.subscription_type;(0,i.saveState)({apiData:e,registrationItems:e.registrations,updateSubscriptionType:t}),document.querySelector(".update_button_wrap")?.setAttribute("style","display:none"),document.getElementById("resetRegistrations")?.setAttribute("style","display:none"),(0,s.initManageRegistrationTable)(e.registrations,f),document.getElementById("subscription_items_list")?.addEventListener("click",e=>{let t=e.target.closest(".remove_registration_button");t&&function(e){let t=e.closest("tr");if(!t)return;let n=(0,i.loadState)();if(n.registrationItems.length<=1){alert("You must keep at least one registration.");return}t.remove();let o=n.registrationItems.filter(e=>!(e.session_id.toString()===t.getAttribute("data-session-id")&&e.student_profile.id.toString()===t.getAttribute("data-student-id")));(0,i.saveState)({registrationItems:o}),b(),document.querySelector(".update_button_wrap")?.setAttribute("style","display:block"),document.getElementById("resetRegistrations")?.setAttribute("style","display:block")}(t)}),b(),document.querySelector(".success_trigger")?.click();let n=new a.WFFormComponent("#cancelSubscriptionForm"),o=document.querySelector("#removeStudentDialog"),l=new a.WFComponent(".page_main"),p=new a.WFComponent("#submitUpdateError"),c=document.querySelector("#submitUpdateLoading"),u=document.getElementById("submitUpdateBtn");document.getElementById("submit_subscription_update")?.addEventListener("click",e=>{e.preventDefault(),p.getElement().style.display="none",c.style.display="none",l.setAttribute("data-brand","6"),o.showModal()}),n.onFormSubmit(async(e,t)=>{t.preventDefault(),p.getElement().style.display="none";let o=e.removed_because.trim();if(!o){p.setText("Please enter a reason for your changes."),p.getElement().style.display="block";return}c.style.display="block";try{let e=(0,i.loadState)(),t=e.apiData.registrations.map(e=>e.id),a=e.registrationItems.map(e=>e.id),s=t.filter(e=>!a.includes(e));await (0,r.apiClient).post("/subscriptions/update",{data:{subscription_id:e.apiData.id,registration_item_ids:s,reason:o}}).fetch();let p=await (0,r.apiClient).post("/subscriptions/manage-subscription").fetch();(0,i.saveState)({apiData:p,registrationItems:p.registrations}),b(),n.showSuccessState(),l.setAttribute("data-brand","4")}catch(e){console.error("Update failed:",e),n.showErrorState()}finally{c.style.display="none",u.removeAttribute("disabled")}}),document.getElementById("close-dialog-btn")?.addEventListener("click",()=>{o.close(),l.setAttribute("data-brand","2"),n.showForm(),n.resetForm(),n.enableForm()}),document.getElementById("resetRegistrations")?.addEventListener("click",()=>{let e=i.loadState().apiData.registrations;i.saveState({registrationItems:e}),b(),document.querySelector(".update_button_wrap")?.setAttribute("style","display:none"),document.getElementById("resetRegistrations")?.setAttribute("style","display:none")}),new g.CancelSubscriptionDialog}function b(){let e=(0,i.loadState)(),t=e.apiData,n=e.registrationItems;(0,s.initManageRegistrationTable)(n,f),(0,l.initManageLineItems)(t,n,e.updateSubscriptionType,{listSelector:"#subscription_line_items_list",wrapSelector:"#subscription_line_items_wrap",emptySelector:"#subscription_line_items_empty",templateSelector:"#subscription_line_item"}),(0,p.updateSubscriptionSummary)(),(0,c.initManageDepositItems)(t,n,{containerSelector:"#deposit_line_items_container",listSelector:"#deposit_line_items_list",templateRowSelector:"#deposit_item_template",totalSelector:"#deposit_total"}),(0,u.updateAmountDue)(),(0,m.updatePendingStudentsAlert)(t),(0,d.updateTrialAlert)(t),(0,y.manageSubscriptionDetails)()}window.renderAll=b},{"../../api/apiConfig":"dUmIV","@xatom/core":"65YBq","./state/manageSubscriptionState":"1QJMa","./components/manageRegistrationTable":"dTqsb","./components/manageSubscriptionLineItems":"jEEHZ","./components/manageSubscriptionSummary":"6ZLwF","./components/manageDepositLineItems":"3mTm6","./components/manageAmountDue":"am4Iu","./components/managePendingStudentsAlert":"b2MjB","./components/manageTrialAlert":"f8n1y","./components/manageSubscriptionDetails":"7KC0F","./components/manageSubscriptionCancelDialog":"9JwnR","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"1QJMa":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"loadState",()=>i),o.export(n,"saveState",()=>s);let r="manageSubscriptionState",a=function(){try{let e=localStorage.getItem(r);return e?JSON.parse(e):null}catch(e){return console.error("Error loading manage subscription state:",e),null}}()||{apiData:void 0,registrationItems:[],updateSubscriptionType:void 0};function i(){return a}function s(e){!function(e){try{localStorage.setItem(r,JSON.stringify(e))}catch(e){console.error("Error saving manage subscription state:",e)}}(a={...a,...e})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],dTqsb:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"initManageRegistrationTable",()=>a);var r=e("@xatom/core");function a(e,t){let n=new r.WFComponent(t.tableBodySelector).getElement(),o=document.querySelector(t.templateRowSelector),a=document.querySelector(t.emptyStateSelector);if(!o){console.error("Template row not found:",t.templateRowSelector);return}if(!a){console.error("Empty state row not found:",t.emptyStateSelector);return}if(Array.from(n.querySelectorAll("tr")).forEach(e=>{e!==o&&e!==a&&e.remove()}),0===e.length){a.style.display="table-row";return}a.style.display="none",e.forEach(e=>{let t=o.cloneNode(!0);t.removeAttribute("id"),t.style.display="table-row",t.setAttribute("data-program-id",String(e.program_id)),t.setAttribute("data-workshop-id",String(e.workshop_id)),t.setAttribute("data-session-id",String(e.session_id)),t.setAttribute("data-student-id",String(e.student_profile.id));let r=t.querySelector("#item_program_name");r&&(r.textContent=e.program_details.name);let a=t.querySelector("#item_workshop_name"),i=e.workshop_details?.Name||"-";a&&(a.textContent=i);let s=t.querySelector("#item_session_name");s&&(s.textContent=e.session_details.Name);let l=t.querySelector("#item_student_name");l&&(l.textContent=`${e.student_profile.first_name} ${e.student_profile.last_name}`),Array.from(t.querySelectorAll("select")).forEach(e=>{e.style.display="none"});let p=t.querySelector(".add_registration_button");p&&(p.style.display="none"),n.appendChild(t)})}},{"@xatom/core":"65YBq","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],jEEHZ:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"initManageLineItems",()=>a);var r=e("@xatom/core");function a(e,t,n,o){let a="year"===n?"/year":"month"===n?"/month":"/semester",i=t.map(e=>{let t=e.session_details,o=t.tuition_product,r=parseFloat((("year"===n?o.Displayed_annual_price:"month"===n?o.Displayed_monthly_price:o.Displayed_semester_price)||"").replace(/[^0-9\.]/g,""))||0;return{productName:t.Name,unitPrice:r,quantity:1,total:r}}),s=new Map;i.forEach(e=>{let t=e.productName;if(s.has(t)){let n=s.get(t);n.quantity+=e.quantity,n.total+=e.total}else s.set(t,{...e})});let l=Array.from(s.values()),p=new r.WFComponent(o.wrapSelector).getElement(),c=document.querySelector(o.emptySelector),u=document.querySelector(o.templateSelector),m=new r.WFComponent(o.listSelector).getElement();if(!u){console.error("Line-item template not found:",o.templateSelector);return}if(Array.from(m.children).forEach(e=>{e.id!==u.id&&m.removeChild(e)}),0===l.length){p.style.display="none",c&&(c.style.display="flex");return}p.style.display="flex",c&&(c.style.display="none"),l.forEach(e=>{let t=u.cloneNode(!0);t.removeAttribute("id"),t.style.display="flex";let n=t.querySelector("#subscription_item_product");n&&(n.textContent=e.productName);let o=t.querySelector("#subscription_item_unit_amount");o&&(o.textContent=`$${e.unitPrice.toFixed(2)}`);let r=t.querySelector("#subscription_item_quantity");r&&(r.textContent=String(e.quantity));let i=t.querySelector("#subscription_item_total");i&&(i.textContent=`$${e.total.toFixed(2)} ${a}`),m.appendChild(t)})}},{"@xatom/core":"65YBq","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"6ZLwF":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"updateSubscriptionSummary",()=>i);var r=e("@xatom/core"),a=e("../state/manageSubscriptionState");function i(){let e=Array.from(document.querySelectorAll("#subscription_line_items_list .line_item_total")).map(e=>parseFloat((e.textContent||"").replace(/[^0-9.]/g,""))||0).reduce((e,t)=>e+t,0),t=(0,a.loadState)(),n=t.apiData?.financial_aid?.selected_discount||0,o=t.updateSubscriptionType||t.apiData?.subscription_type||"month",i="year"===o?"/year":"semester"===o?"/semester":"/month",s=new r.WFComponent("#subscription_total"),l=new r.WFComponent("#subscription_original_amount"),p=new r.WFComponent("#subscription_discount_pill"),c=new r.WFComponent("#subscription_discount_applied");n>0?(c.setText(`${n}%`),p.getElement().style.display="block",l.setText(`was $${e.toFixed(2)} ${i}`),l.getElement().style.display="block"):(p.getElement().style.display="none",l.getElement().style.display="none"),s.setText(`$${(e-n/100*e).toFixed(2)} ${i}`)}},{"@xatom/core":"65YBq","../state/manageSubscriptionState":"1QJMa","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"3mTm6":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"initManageDepositItems",()=>a);var r=e("@xatom/core");function a(e,t,n){let o=new r.WFComponent(n.containerSelector).getElement(),a=document.querySelector(n.listSelector),i=document.querySelector(n.templateRowSelector),s=new r.WFComponent(n.totalSelector);if("Deposit Paid"!==e.status){o&&(o.style.display="none");return}if(!o||!a||!i){console.error("Deposit items: missing selectors");return}let l=[];t.forEach(e=>{let t=e.session_details.deposit_product,n=t?.Single_sale_price_amount||0;n>0&&l.push({productName:t.Product_name||e.session_details.Name,unitPrice:n,quantity:1,total:n})});let p=new Map;l.forEach(e=>{if(p.has(e.productName)){let t=p.get(e.productName);t.quantity+=e.quantity,t.total+=e.total}else p.set(e.productName,{...e})});let c=Array.from(p.values());Array.from(a.children).forEach(e=>{e!==i&&a.removeChild(e)});let u=c.reduce((e,t)=>e+t.total,0);if(u<=0){o.style.display="none";return}o.style.display="flex",i.style.display="none",c.forEach(e=>{let t=i.cloneNode(!0);t.removeAttribute("id"),t.style.display="flex";let n=t.querySelector("#deposit_item_product");n&&(n.textContent=e.productName);let o=t.querySelector("#deposit_item_unit_amount");o&&(o.textContent=`$${e.unitPrice.toFixed(2)}`);let r=t.querySelector("#deposit_item_quantity");r&&(r.textContent=String(e.quantity));let s=t.querySelector("#deposit_item_total");s&&(s.textContent=`$${e.total.toFixed(2)}`),a.appendChild(t)}),s.setText(`$${u.toFixed(2)}`)}},{"@xatom/core":"65YBq","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],am4Iu:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"updateAmountDue",()=>i);var r=e("@xatom/core"),a=e("../state/manageSubscriptionState");function i(){let e=(0,a.loadState)(),t=e.apiData,n=document.querySelector("#amountDueContainer");if(!n){console.error("#amountDueContainer not found");return}if("Deposit Paid"!==t.status){n.style.display="none";return}n.style.display="flex",new(0,r.WFComponent)("#amountDueLable").setText("Amount Due Upon Approval");let o=Array.from(document.querySelectorAll("#subscription_line_items_list .line_item_total")).reduce((e,t)=>{let n=parseFloat((t.textContent||"").replace(/[^0-9.]/g,""));return e+(isNaN(n)?0:n)},0),i=Array.from(document.querySelectorAll("#deposit_line_items_list .line_item_total")).reduce((e,t)=>{let n=parseFloat((t.textContent||"").replace(/[^0-9.]/g,""));return e+(isNaN(n)?0:n)},0),s=e.apiData?.financial_aid?.selected_discount??0;new(0,r.WFComponent)("#total_amount_due_next_invoice").setText(`$${Math.max(0,o-i-o*s/100).toFixed(2)}`)}},{"@xatom/core":"65YBq","../state/manageSubscriptionState":"1QJMa","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],b2MjB:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"updatePendingStudentsAlert",()=>a);var r=e("@xatom/core");function a(e){let t=new(0,r.WFComponent)("#alertBox").getElement();console.log("[updatePendingStudentsAlert] status=",e.status,"pending_students=",e.pending_students),console.log("[updatePendingStudentsAlert] alertEl=",t),"Deposit Paid"===e.status&&e.pending_students?t.style.display="flex":t.style.display="none"}},{"@xatom/core":"65YBq","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],f8n1y:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"updateTrialAlert",()=>a);var r=e("@xatom/core");function a(e){let t=new(0,r.WFComponent)("#alertBoxTrial").getElement(),n=new(0,r.WFComponent)("#subscription_trial_end_date").getElement(),o=Date.now(),a=e.free_trial_end||0;if(a&&a>o||e.early_registration){let o=new Date(a).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"});n.textContent=o;let r="Deposit Paid"===e.status?"When approved your":"Your",i="Deposit Paid"===e.status?"begin":"resume";t.querySelector(".alert-title").innerHTML=`${r} subscription is scheduled to ${i} on <span id="subscription_trial_end_date">${o}</span>. If you've paid a deposit, your initial invoice will commence on the same date.`,t.style.display="flex"}else t.style.display="none"}},{"@xatom/core":"65YBq","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"7KC0F":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"manageSubscriptionDetails",()=>i);var r=e("@xatom/core"),a=e("../state/manageSubscriptionState");function i(){let e=(0,a.loadState)(),t=e.apiData,n="trial"===t.status.toLowerCase()?"Scheduled":t.status;new(0,r.WFComponent)("#status").setText(n);let o=e.updateSubscriptionType||t.subscription_type;new(0,r.WFComponent)("#subscriptionType").setText(o);let i=t.financial_aid,s=i?.selected_discount!=null&&i.selected_discount>0,l=document.querySelector("#finAidRequestedWrap"),p=new r.WFComponent("#finAidRequested"),c=document.querySelector("#finAidAppliedWrap"),u=new r.WFComponent("#finAidApplied");l&&c?s?(p.setText("True"),l.style.display="flex",u.setText(`${i.selected_discount}%`),c.style.display="flex"):(l.style.display="none",c.style.display="none"):console.error("manageSubscriptionDetails: missing financial aid selectors")}},{"@xatom/core":"65YBq","../state/manageSubscriptionState":"1QJMa","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"9JwnR":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"CancelSubscriptionDialog",()=>s);var r=e("@xatom/core"),a=e("../../../api/apiConfig"),i=e("../state/manageSubscriptionState");class s{constructor(){this.dialogComp=new r.WFComponent("#cancelSubscriptionDialog"),this.formComp=new r.WFFormComponent("#cancelFullSubscriptionForm"),this.openBtnComp=new r.WFComponent("#openCancelSubscription"),this.closeBtnComp=new r.WFComponent("#close-cancel-dialog-btn"),this.submitBtnComp=new r.WFComponent("#submitCancel"),this.loadingComp=new r.WFComponent("#submitCancelLoading"),this.reasonError=new r.WFComponent("#submitCancelError"),this.pageMainComp=new r.WFComponent(".page_main");let e=(0,i.loadState)();e.apiData?.status==="Cancelled"&&(this.openBtnComp.getElement().style.display="none"),this.attachListeners()}attachListeners(){this.formComp.onFormSubmit(async(e,t)=>{t.preventDefault(),this.reasonError.getElement().style.display="none";let n=e.removed_because.trim();if(!n){this.reasonError.setText("Reason is required."),this.reasonError.getElement().style.display="block";return}await this.submitCancel(n)}),this.openBtnComp.on("click",e=>{e.preventDefault(),this.reasonError.getElement().style.display="none",this.loadingComp.getElement().style.display="none",this.openDialog()});let e=this.dialogComp.getElement();e.addEventListener("click",t=>{t.target===e&&this.closeDialog()}),this.closeBtnComp.on("click",()=>this.closeDialog())}openDialog(){this.pageMainComp.setAttribute("data-brand","6"),this.dialogComp.getElement().showModal()}closeDialog(){this.dialogComp.getElement().close(),this.pageMainComp.setAttribute("data-brand","2")}async submitCancel(e){this.loadingComp.getElement().style.display="block",this.submitBtnComp.getElement().setAttribute("disabled","true");try{let t=(0,i.loadState)(),n=await (0,a.apiClient).post("/subscriptions/cancel",{data:{subscription_id:t.apiData.id,reason:e}}).fetch(),o=(n.registrations||[]).filter(e=>{let t=e.status.toUpperCase();return"CANCELLED"!==t&&"WAITLIST"!==t&&"DRAFT"!==t&&"PENDING"!==t});(0,i.saveState)({apiData:n,registrationItems:o}),window.renderAll(),this.formComp.showSuccessState(),this.pageMainComp.setAttribute("data-brand","4")}catch(e){console.error("Cancel failed:",e),this.formComp.showErrorState()}finally{this.loadingComp.getElement().style.display="none",this.submitBtnComp.getElement().removeAttribute("disabled")}}}},{"@xatom/core":"65YBq","../../../api/apiConfig":"dUmIV","../state/manageSubscriptionState":"1QJMa","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}]},[],0,"parcelRequired346");
//# sourceMappingURL=manageSubscription.57a6a6f1.js.map
