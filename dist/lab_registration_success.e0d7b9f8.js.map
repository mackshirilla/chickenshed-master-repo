{"mappings":"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","sources":["src/modules/success_page/lab_registration_success.ts","node_modules/.pnpm/@xatom+image@1.0.0_@xatom+core@1.0.12/node_modules/@xatom/image/dist/index.js"],"sourcesContent":["// src/success_page/lab_registration_success.ts\n\nimport { WFComponent, WFDynamicList } from \"@xatom/core\";\nimport { WFImage } from \"@xatom/image\";\nimport { apiClient } from \"../../api/apiConfig\";\n\n// ---------- Types ----------\ninterface ProgramDetails {\n  id: number;\n  name: string;\n  Main_Image?: string | null;\n}\ninterface WorkshopDetails {\n  id: number;\n  Name: string;\n  Main_Image?: string | null;\n}\ninterface SessionDetails {\n  id: number;\n  Name: string;\n  Start_Date: number | null;\n}\nexport interface LabRegistrationItem {\n  id: number;\n  status: string;\n  program_name: string;\n  workshop_name: string;\n  session_id: number;\n  workshop_id: number; // present in API; used for grouping\n  checkout_session_id: string;\n  program_details?: ProgramDetails | null;\n  workshop_details?: WorkshopDetails | null;\n  session_details?: SessionDetails | null;\n}\ninterface ApiResponse {\n  data: LabRegistrationItem[];\n}\n\n// ---------- Helpers ----------\nconst getSessionIdFromUrl = (): string | null => {\n  const params = new URLSearchParams(window.location.search);\n  // Your success URLs use ?order={CHECKOUT_SESSION_ID}; fall back to ?session_id\n  return params.get(\"order\") || params.get(\"session_id\");\n};\n\nconst chooseImage = (item: LabRegistrationItem): string | null =>\n  item.workshop_details?.Main_Image || item.program_details?.Main_Image || null;\n\n/** Group items by workshop (workshop_id or workshop_details.id).\n *  For each group, pick a representative row (earliest Start_Date if available).\n */\nconst groupByWorkshop = (items: LabRegistrationItem[]): LabRegistrationItem[] => {\n  const groups = new Map<number, LabRegistrationItem[]>();\n\n  for (const it of items) {\n    const key =\n      it.workshop_id ??\n      it.workshop_details?.id ??\n      // very defensive fallback (unlikely needed)\n      Math.abs((it.workshop_name || \"\").toLowerCase().split(\"\").reduce((a, c) => a + c.charCodeAt(0), 0));\n    const arr = groups.get(key) ?? [];\n    arr.push(it);\n    groups.set(key, arr);\n  }\n\n  // choose one representative per workshop (earliest session start if available)\n  const reps: LabRegistrationItem[] = [];\n  for (const arr of groups.values()) {\n    const best = arr\n      .slice()\n      .sort((a, b) => {\n        const da = a.session_details?.Start_Date ?? Number.MAX_SAFE_INTEGER;\n        const db = b.session_details?.Start_Date ?? Number.MAX_SAFE_INTEGER;\n        return da - db;\n      })[0];\n    reps.push(best);\n  }\n\n  // order cards by earliest start date (then name)\n  reps.sort((a, b) => {\n    const da = a.session_details?.Start_Date ?? Number.MAX_SAFE_INTEGER;\n    const db = b.session_details?.Start_Date ?? Number.MAX_SAFE_INTEGER;\n    if (da !== db) return da - db;\n    return (a.workshop_name || \"\").localeCompare(b.workshop_name || \"\");\n  });\n\n  return reps;\n};\n\n/** Add a stable hook class and strip id so cloned rows don't duplicate IDs. */\nconst hookAndStrip = (root: HTMLElement, idOrClass: string, hookClass: string): HTMLElement | null => {\n  // Accept either an element with that id, or one already using our hookClass\n  const el = root.querySelector<HTMLElement>(`#${idOrClass}, .${hookClass}`);\n  if (!el) return null;\n  if (!el.classList.contains(hookClass)) el.classList.add(hookClass);\n  if (el.id === idOrClass) el.removeAttribute(\"id\");\n  return el;\n};\n// ---------- Master: always renders a (grouped-by-workshop) list ----------\nexport async function handleLabRegistrationSuccess() {\n    const urlSessionId = getSessionIdFromUrl();\n    if (!urlSessionId) {\n      console.error(\"Missing order/session_id param in URL\");\n      return;\n    }\n  \n    const req = apiClient.get<ApiResponse>(\n      `/success_page/lab_registration/${encodeURIComponent(urlSessionId)}`\n    );\n  \n    try {\n      const { data } = await new Promise<ApiResponse>((resolve, reject) => {\n        req.onData((res) => resolve(res));\n        req.onError(reject);\n        req.fetch();\n      });\n  \n      const rawItems = Array.isArray(data) ? data : [];\n      if (!rawItems.length) {\n        console.warn(\"No lab registrations returned.\");\n      }\n  \n      // 1) Group by workshop\n      const grouped = groupByWorkshop(rawItems);\n  \n      // 2) Build the dynamic list using your Webflow structure\n      const list = new WFDynamicList<LabRegistrationItem>(\"#labList\", {\n        rowSelector: \"#labRegistrationCard\",\n      });\n  \n      list.rowRenderer(({ rowData, rowElement }) => {\n        const rowRoot = rowElement.getElement() as HTMLElement;\n  \n        rowRoot.classList.add(\"js-labRegistrationCard\");\n        if (rowRoot.id === \"labRegistrationCard\") rowRoot.removeAttribute(\"id\");\n  \n        const imgEl   = hookAndStrip(rowRoot, \"labCardImage\",   \"js-labCardImage\");\n        const progEl  = hookAndStrip(rowRoot, \"labCardProgram\", \"js-labCardProgram\");\n        const workEl  = hookAndStrip(rowRoot, \"labCardWorkshop\",\"js-labCardWorkshop\");\n  \n        // Image\n        if (imgEl instanceof HTMLImageElement) {\n          const wfImg = new WFImage(imgEl);\n          const src = chooseImage(rowData);\n          if (src) wfImg.setImage(src);\n          (wfImg.getElement() as HTMLImageElement).alt =\n            `${rowData.program_name} â€” ${rowData.workshop_name}`;\n        }\n  \n        if (progEl) new WFComponent(progEl).setText(rowData.program_name || \"\");\n        if (workEl) new WFComponent(workEl).setText(rowData.workshop_name || \"\");\n  \n        // Preserve ?order param, plus append program + subscription=none\n        try {\n          const anchor = rowRoot as HTMLAnchorElement;\n          const href = anchor.getAttribute(\"href\") || \"#\";\n          const u = new URL(href, window.location.origin);\n          u.searchParams.set(\"order\", rowData.checkout_session_id || urlSessionId);\n          u.searchParams.set(\"program\", String(rowData.program_details?.id ?? \"\"));\n          u.searchParams.set(\"subscription\", \"none\");\n          anchor.setAttribute(\"href\", u.toString());\n        } catch {\n          /* noop */\n        }\n  \n        rowRoot.style.display = \"block\";\n        return rowElement;\n      });\n  \n      list.setData(grouped);\n  \n      const container = document.getElementById(\"labList\");\n      if (container) container.style.display = \"block\";\n      document.querySelector<HTMLElement>(\".success_trigger\")?.click();\n    } catch (err) {\n      console.error(\"Error loading lab registration list:\", err);\n    }\n  }\n  \n\n// Auto-init on DOM ready\ndocument.addEventListener(\"DOMContentLoaded\", handleLabRegistrationSuccess);\n","var t=require(\"@xatom/core\");var e,r,s,i,o,n,u={};e=u,r=\"WFImage\",s=()=>c,Object.defineProperty(e,r,{get:s,set:i,enumerable:!0,configurable:!0});class c extends t.WFComponent{constructor(t){super(t)}getImageConfig(){return this._config}getSrc(){return this.getAttribute(\"src\")}getSizes(){return this.getAttribute(\"sizes\")}getSrcSet(){return this.getAttribute(\"srcset\")}getLoading(){return this.getAttribute(\"loading\")}onLoad(t){return this.on(\"load\",t),()=>{this.off(\"load\",t)}}onLoadError(t){return this.on(\"error\",t),()=>{this.off(\"error\",t)}}setImage(t){if(\"string\"==typeof t)this.setAttribute(\"src\",t),this.removeAttribute(\"srcset\"),this.removeAttribute(\"sizes\");else{if(this.setAttribute(\"src\",t.src),\"object\"==typeof t&&t.srcSet&&t.srcSet.length&&t.sizes&&t.sizes.length){const e=t.srcSet.map((t=>`${t.url} ${t.size}`)).join(\", \");this.setAttribute(\"srcset\",e)}else this.removeAttribute(\"srcset\"),this.removeAttribute(\"sizes\");t.loading&&this.setAttribute(\"loading\",t.loading)}}}o=module.exports,n=u,Object.keys(n).forEach((function(t){\"default\"===t||\"__esModule\"===t||o.hasOwnProperty(t)||Object.defineProperty(o,t,{enumerable:!0,get:function(){return n[t]}})}));"],"names":[],"version":3,"file":"lab_registration_success.e0d7b9f8.js.map","sourceRoot":"../"}