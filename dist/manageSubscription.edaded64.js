!function(e,t,n,o,r){var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},a="function"==typeof i[o]&&i[o],s=a.cache||{},l="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function c(t,n){if(!s[t]){if(!e[t]){var r="function"==typeof i[o]&&i[o];if(!n&&r)return r(t,!0);if(a)return a(t,!0);if(l&&"string"==typeof t)return l(t);var p=Error("Cannot find module '"+t+"'");throw p.code="MODULE_NOT_FOUND",p}m.resolve=function(n){var o=e[t][1][n];return null!=o?o:n},m.cache={};var u=s[t]=new c.Module(t);e[t][0].call(u.exports,m,u,u.exports,this)}return s[t].exports;function m(e){var t=m.resolve(e);return!1===t?{}:c(t)}}c.isParcelRequire=!0,c.Module=function(e){this.id=e,this.bundle=c,this.exports={}},c.modules=e,c.cache=s,c.parent=a,c.register=function(t,n){e[t]=[function(e,t){t.exports=n},{}]},Object.defineProperty(c,"root",{get:function(){return i[o]}}),i[o]=c;for(var p=0;p<t.length;p++)c(t[p])}({iTZac:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"manageSubscriptionPage",()=>b),o.export(n,"renderAll",()=>S);var r=e("../../api/apiConfig"),i=e("@xatom/core"),a=e("./state/manageSubscriptionState"),s=e("./components/manageRegistrationTable"),l=e("./components/manageSubscriptionLineItems"),c=e("./components/manageSubscriptionSummary"),p=e("./components/manageDepositLineItems"),u=e("./components/manageAmountDue"),m=e("./components/managePendingStudentsAlert"),d=e("./components/manageTrialAlert"),y=e("./components/manageSubscriptionDetails"),g=e("./components/manageSubscriptionCancelDialog");let f={tableBodySelector:"#subscription_items_list",templateRowSelector:"#subscription_item",emptyStateSelector:"#subscription_empty"};async function b(){let e=await (0,r.apiClient).post("/subscriptions/manage-subscription").fetch();if(!e||!e.id){window.location.href="/dashboard";return}let t=e.update_subscription_type||e.subscription_type;(0,a.saveState)({apiData:e,registrationItems:e.registrations,updateSubscriptionType:t}),document.querySelector(".update_button_wrap")?.setAttribute("style","display:none"),document.getElementById("resetRegistrations")?.setAttribute("style","display:none"),(0,s.initManageRegistrationTable)(e.registrations,f),document.getElementById("subscription_items_list")?.addEventListener("click",e=>{let t=e.target.closest(".remove_registration_button");t&&function(e){let t=e.closest("tr");if(!t)return;let n=(0,a.loadState)();if(n.registrationItems.length<=1){alert("You must keep at least one registration.");return}t.remove();let o=n.registrationItems.filter(e=>!(e.session_id.toString()===t.getAttribute("data-session-id")&&e.student_profile.id.toString()===t.getAttribute("data-student-id")));(0,a.saveState)({registrationItems:o}),S(),document.querySelector(".update_button_wrap")?.setAttribute("style","display:block"),document.getElementById("resetRegistrations")?.setAttribute("style","display:block")}(t)}),S(),document.querySelector(".success_trigger")?.click();let n=new i.WFFormComponent("#cancelSubscriptionForm"),o=document.querySelector("#removeStudentDialog"),l=new i.WFComponent(".page_main"),c=new i.WFComponent("#submitUpdateError"),p=document.querySelector("#submitUpdateLoading"),u=document.getElementById("submitUpdateBtn");document.getElementById("submit_subscription_update")?.addEventListener("click",e=>{e.preventDefault(),c.getElement().style.display="none",p.style.display="none",l.setAttribute("data-brand","6"),o.showModal()}),n.onFormSubmit(async(e,t)=>{t.preventDefault(),c.getElement().style.display="none";let o=e.removed_because.trim();if(!o){c.setText("Please enter a reason for your changes."),c.getElement().style.display="block";return}p.style.display="block";try{let e=(0,a.loadState)(),t=e.apiData.registrations.map(e=>e.id),i=e.registrationItems.map(e=>e.id),s=t.filter(e=>!i.includes(e));await (0,r.apiClient).post("/subscriptions/update",{data:{subscription_id:e.apiData.id,registration_item_ids:s,reason:o}}).fetch();let c=await (0,r.apiClient).post("/subscriptions/manage-subscription").fetch();(0,a.saveState)({apiData:c,registrationItems:c.registrations}),S(),n.showSuccessState(),l.setAttribute("data-brand","4")}catch(e){console.error("Update failed:",e),n.showErrorState()}finally{p.style.display="none",u.removeAttribute("disabled")}}),document.getElementById("close-dialog-btn")?.addEventListener("click",()=>{o.close(),l.setAttribute("data-brand","2"),n.showForm(),n.resetForm(),n.enableForm()}),document.getElementById("resetRegistrations")?.addEventListener("click",()=>{let e=a.loadState().apiData.registrations;a.saveState({registrationItems:e}),S(),document.querySelector(".update_button_wrap")?.setAttribute("style","display:none"),document.getElementById("resetRegistrations")?.setAttribute("style","display:none")}),new g.CancelSubscriptionDialog}function S(){let e=(0,a.loadState)(),t=e.apiData,n=e.registrationItems;(0,s.initManageRegistrationTable)(n,f),(0,l.initManageLineItems)(t,n,e.updateSubscriptionType,{listSelector:"#subscription_line_items_list",wrapSelector:"#subscription_line_items_wrap",emptySelector:"#subscription_line_items_empty",templateSelector:"#subscription_line_item"}),(0,c.updateSubscriptionSummary)(),(0,p.initManageDepositItems)(t,n,{containerSelector:"#deposit_line_items_container",listSelector:"#deposit_line_items_list",templateRowSelector:"#deposit_item_template",totalSelector:"#deposit_total"}),(0,u.updateAmountDue)(),(0,m.updatePendingStudentsAlert)(t),(0,d.updateTrialAlert)(t),(0,y.manageSubscriptionDetails)()}window.renderAll=S},{"../../api/apiConfig":"dUmIV","@xatom/core":"65YBq","./state/manageSubscriptionState":"1QJMa","./components/manageRegistrationTable":"dTqsb","./components/manageSubscriptionLineItems":"jEEHZ","./components/manageSubscriptionSummary":"6ZLwF","./components/manageDepositLineItems":"3mTm6","./components/manageAmountDue":"am4Iu","./components/managePendingStudentsAlert":"b2MjB","./components/manageTrialAlert":"f8n1y","./components/manageSubscriptionDetails":"7KC0F","./components/manageSubscriptionCancelDialog":"9JwnR","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"1QJMa":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"loadState",()=>a),o.export(n,"saveState",()=>s);let r="manageSubscriptionState",i=function(){try{let e=localStorage.getItem(r);return e?JSON.parse(e):null}catch(e){return console.error("Error loading manage subscription state:",e),null}}()||{apiData:void 0,registrationItems:[],updateSubscriptionType:void 0};function a(){return i}function s(e){!function(e){try{localStorage.setItem(r,JSON.stringify(e))}catch(e){console.error("Error saving manage subscription state:",e)}}(i={...i,...e})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],dTqsb:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"initManageRegistrationTable",()=>i);var r=e("@xatom/core");function i(e,t){let n=new r.WFComponent(t.tableBodySelector).getElement(),o=document.querySelector(t.templateRowSelector),i=document.querySelector(t.emptyStateSelector);if(!o){console.error("Template row not found:",t.templateRowSelector);return}if(!i){console.error("Empty state row not found:",t.emptyStateSelector);return}if(Array.from(n.querySelectorAll("tr")).forEach(e=>{e!==o&&e!==i&&e.remove()}),0===e.length){i.style.display="table-row";return}i.style.display="none",e.forEach(e=>{let t=o.cloneNode(!0);t.removeAttribute("id"),t.style.display="table-row",t.setAttribute("data-program-id",String(e.program_id)),t.setAttribute("data-workshop-id",String(e.workshop_id)),t.setAttribute("data-session-id",String(e.session_id)),t.setAttribute("data-student-id",String(e.student_profile?.id||e.student_id));let r=t.querySelector("#item_program_name");r&&(r.textContent=e.program_details.name);let i=t.querySelector("#item_workshop_name"),a=e.workshop_details?.Name||"-";i&&(i.textContent=a);let s=t.querySelector("#item_session_name");s&&(s.textContent=`${e.session_details.Weekday} ${e.session_details.Time_block}`);let l=t.querySelector("#item_student_name");l&&(l.textContent=`${e.student_profile.first_name} ${e.student_profile.last_name}`),Array.from(t.querySelectorAll("select")).forEach(e=>{e.style.display="none"});let c=t.querySelector(".add_registration_button");c&&(c.style.display="none"),n.appendChild(t)})}},{"@xatom/core":"65YBq","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],jEEHZ:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"initManageLineItems",()=>i);var r=e("@xatom/core");function i(e,t,n,o){let i="year"===n?"/year":"month"===n?"/month":"/semester",a=t.map(e=>{let t=e.session_details,o=t.tuition_product,r=parseFloat((("year"===n?o.Displayed_annual_price:"month"===n?o.Displayed_monthly_price:o.Displayed_semester_price)||"").replace(/[^0-9\.]/g,""))||0;return{productName:t.Name,unitPrice:r,quantity:1,total:r}}),s=new Map;a.forEach(e=>{let t=e.productName;if(s.has(t)){let n=s.get(t);n.quantity+=e.quantity,n.total+=e.total}else s.set(t,{...e})});let l=Array.from(s.values()),c=new r.WFComponent(o.wrapSelector).getElement(),p=document.querySelector(o.emptySelector),u=document.querySelector(o.templateSelector),m=new r.WFComponent(o.listSelector).getElement();if(!u){console.error("Line-item template not found:",o.templateSelector);return}if(Array.from(m.children).forEach(e=>{e.id!==u.id&&m.removeChild(e)}),0===l.length){c.style.display="none",p&&(p.style.display="flex");return}c.style.display="flex",p&&(p.style.display="none"),l.forEach(e=>{let t=u.cloneNode(!0);t.removeAttribute("id"),t.style.display="flex";let n=t.querySelector("#subscription_item_product");n&&(n.textContent=e.productName);let o=t.querySelector("#subscription_item_unit_amount");o&&(o.textContent=`$${e.unitPrice.toFixed(2)}`);let r=t.querySelector("#subscription_item_quantity");r&&(r.textContent=String(e.quantity));let a=t.querySelector("#subscription_item_total");a&&(a.textContent=`$${e.total.toFixed(2)} ${i}`),m.appendChild(t)})}},{"@xatom/core":"65YBq","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"6ZLwF":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"updateSubscriptionSummary",()=>a);var r=e("@xatom/core"),i=e("../state/manageSubscriptionState");function a(){let e=Array.from(document.querySelectorAll("#subscription_line_items_list .line_item_total")).map(e=>parseFloat((e.textContent||"").replace(/[^0-9.]/g,""))||0).reduce((e,t)=>e+t,0),t=(0,i.loadState)(),n=t.apiData,o=n.financial_aid?.selected_discount??0,a=n.subscription_amount_discount||0,s=`${(e>0?a/e*100:0).toFixed(0)}% ${o>0?"Financial Aid":"Discount"}`,l=t.updateSubscriptionType||n.subscription_type||"month",c="year"===l?"/year":"semester"===l?"/semester":"/month",p=new r.WFComponent("#subscription_total"),u=new r.WFComponent("#subscription_original_amount"),m=new r.WFComponent("#subscription_discount_pill"),d=new r.WFComponent("#subscription_discount_applied");a>0?(d.setText(s),m.getElement().style.display="block",u.setText(`was $${e.toFixed(2)} ${c}`),u.getElement().style.display="block"):(m.getElement().style.display="none",u.getElement().style.display="none"),p.setText(`$${(e-a).toFixed(2)} ${c}`)}},{"@xatom/core":"65YBq","../state/manageSubscriptionState":"1QJMa","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"3mTm6":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"initManageDepositItems",()=>i);var r=e("@xatom/core");function i(e,t,n){let o=new r.WFComponent(n.containerSelector).getElement(),i=document.querySelector(n.listSelector),a=document.querySelector(n.templateRowSelector),s=new r.WFComponent(n.totalSelector);if("Deposit Paid"!==e.status){o&&(o.style.display="none");return}if(!o||!i||!a){console.error("Deposit items: missing selectors");return}let l=[];t.forEach(e=>{let t=e.session_details.deposit_product,n=t?.Single_sale_price_amount||0;n>0&&l.push({productName:t.Product_name||e.session_details.Name,unitPrice:n,quantity:1,total:n})});let c=new Map;l.forEach(e=>{if(c.has(e.productName)){let t=c.get(e.productName);t.quantity+=e.quantity,t.total+=e.total}else c.set(e.productName,{...e})});let p=Array.from(c.values());Array.from(i.children).forEach(e=>{e!==a&&i.removeChild(e)});let u=p.reduce((e,t)=>e+t.total,0);if(u<=0){o.style.display="none";return}o.style.display="flex",a.style.display="none",p.forEach(e=>{let t=a.cloneNode(!0);t.removeAttribute("id"),t.style.display="flex";let n=t.querySelector("#deposit_item_product");n&&(n.textContent=e.productName);let o=t.querySelector("#deposit_item_unit_amount");o&&(o.textContent=`$${e.unitPrice.toFixed(2)}`);let r=t.querySelector("#deposit_item_quantity");r&&(r.textContent=String(e.quantity));let s=t.querySelector("#deposit_item_total");s&&(s.textContent=`$${e.total.toFixed(2)}`),i.appendChild(t)}),s.setText(`$${u.toFixed(2)}`)}},{"@xatom/core":"65YBq","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],am4Iu:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"updateAmountDue",()=>a);var r=e("@xatom/core"),i=e("../state/manageSubscriptionState");function a(){let e=(0,i.loadState)(),t=e.apiData,n=document.querySelector("#amountDueContainer");if(!n){console.error("#amountDueContainer not found");return}if("Deposit Paid"!==t.status){n.style.display="none";return}n.style.display="flex",new(0,r.WFComponent)("#amountDueLable").setText("Amount Due Upon Approval");let o=Array.from(document.querySelectorAll("#subscription_line_items_list .line_item_total")).reduce((e,t)=>{let n=parseFloat((t.textContent||"").replace(/[^0-9.]/g,""));return e+(isNaN(n)?0:n)},0),a=Array.from(document.querySelectorAll("#deposit_line_items_list .line_item_total")).reduce((e,t)=>{let n=parseFloat((t.textContent||"").replace(/[^0-9.]/g,""));return e+(isNaN(n)?0:n)},0),s=e.apiData?.financial_aid?.selected_discount??0;new(0,r.WFComponent)("#total_amount_due_next_invoice").setText(`$${Math.max(0,o-a-o*s/100).toFixed(2)}`)}},{"@xatom/core":"65YBq","../state/manageSubscriptionState":"1QJMa","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],b2MjB:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"updatePendingStudentsAlert",()=>i);var r=e("@xatom/core");function i(e){let t=new(0,r.WFComponent)("#alertBox").getElement();console.log("[updatePendingStudentsAlert] status=",e.status,"pending_students=",e.pending_students),console.log("[updatePendingStudentsAlert] alertEl=",t),"Deposit Paid"===e.status&&e.pending_students?t.style.display="flex":t.style.display="none"}},{"@xatom/core":"65YBq","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],f8n1y:[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"updateTrialAlert",()=>i);var r=e("@xatom/core");function i(e){let t=new(0,r.WFComponent)("#alertBoxTrial").getElement(),n=new(0,r.WFComponent)("#subscription_trial_end_date").getElement(),o=Date.now(),i=e.free_trial_end||0;if(i&&i>o||e.early_registration){let o=new Date(i).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"});n.textContent=o;let r="Deposit Paid"===e.status?"When approved your":"Your",a="Deposit Paid"===e.status?"begin":"resume";t.querySelector(".alert-title").innerHTML=`${r} subscription is scheduled to ${a} on <span id="subscription_trial_end_date">${o}</span>. If you've paid a deposit, your initial invoice will commence on the same date.`,t.style.display="flex"}else t.style.display="none"}},{"@xatom/core":"65YBq","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"7KC0F":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"manageSubscriptionDetails",()=>a);var r=e("@xatom/core"),i=e("../state/manageSubscriptionState");function a(){let e=(0,i.loadState)(),t=e.apiData,n="trial"===t.status.toLowerCase()?"Scheduled":t.status;new(0,r.WFComponent)("#status").setText(n);let o=e.updateSubscriptionType||t.subscription_type;new(0,r.WFComponent)("#subscriptionType").setText(o);let a=t.financial_aid,s=a?.selected_discount!=null&&a.selected_discount>0,l=document.querySelector("#finAidRequestedWrap"),c=new r.WFComponent("#finAidRequested"),p=document.querySelector("#finAidAppliedWrap"),u=new r.WFComponent("#finAidApplied");l&&p?s?(c.setText("True"),l.style.display="flex",u.setText(`${a.selected_discount}%`),p.style.display="flex"):(l.style.display="none",p.style.display="none"):console.error("manageSubscriptionDetails: missing financial aid selectors")}},{"@xatom/core":"65YBq","../state/manageSubscriptionState":"1QJMa","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}],"9JwnR":[function(e,t,n){var o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(n),o.export(n,"CancelSubscriptionDialog",()=>s);var r=e("@xatom/core"),i=e("../../../api/apiConfig"),a=e("../state/manageSubscriptionState");class s{constructor(){this.dialogComp=new r.WFComponent("#cancelSubscriptionDialog"),this.formComp=new r.WFFormComponent("#cancelFullSubscriptionForm"),this.openBtnComp=new r.WFComponent("#openCancelSubscription"),this.closeBtnComp=new r.WFComponent("#close-cancel-dialog-btn"),this.submitBtnComp=new r.WFComponent("#submitCancel"),this.loadingComp=new r.WFComponent("#submitCancelLoading"),this.reasonError=new r.WFComponent("#submitCancelError"),this.pageMainComp=new r.WFComponent(".page_main");let e=(0,a.loadState)();e.apiData?.status==="Cancelled"&&(this.openBtnComp.getElement().style.display="none"),this.attachListeners()}attachListeners(){this.formComp.onFormSubmit(async(e,t)=>{t.preventDefault(),this.reasonError.getElement().style.display="none";let n=e.removed_because.trim();if(!n){this.reasonError.setText("Reason is required."),this.reasonError.getElement().style.display="block";return}await this.submitCancel(n)}),this.openBtnComp.on("click",e=>{e.preventDefault(),this.reasonError.getElement().style.display="none",this.loadingComp.getElement().style.display="none",this.openDialog()});let e=this.dialogComp.getElement();e.addEventListener("click",t=>{t.target===e&&this.closeDialog()}),this.closeBtnComp.on("click",()=>this.closeDialog())}openDialog(){this.pageMainComp.setAttribute("data-brand","6"),this.dialogComp.getElement().showModal()}closeDialog(){this.dialogComp.getElement().close(),this.pageMainComp.setAttribute("data-brand","2")}async submitCancel(e){this.loadingComp.getElement().style.display="block",this.submitBtnComp.getElement().setAttribute("disabled","true");try{let t=(0,a.loadState)(),n=await (0,i.apiClient).post("/subscriptions/cancel",{data:{subscription_id:t.apiData.id,reason:e}}).fetch(),o=(n.registrations||[]).filter(e=>{let t=e.status.toUpperCase();return"CANCELLED"!==t&&"WAITLIST"!==t&&"DRAFT"!==t&&"PENDING"!==t});(0,a.saveState)({apiData:n,registrationItems:o}),window.renderAll(),this.formComp.showSuccessState(),this.pageMainComp.setAttribute("data-brand","4")}catch(e){console.error("Cancel failed:",e),this.formComp.showErrorState()}finally{this.loadingComp.getElement().style.display="none",this.submitBtnComp.getElement().removeAttribute("disabled")}}}},{"@xatom/core":"65YBq","../../../api/apiConfig":"dUmIV","../state/manageSubscriptionState":"1QJMa","@parcel/transformer-js/src/esmodule-helpers.js":"jiucr"}]},[],0,"parcelRequired346");
//# sourceMappingURL=manageSubscription.edaded64.js.map
