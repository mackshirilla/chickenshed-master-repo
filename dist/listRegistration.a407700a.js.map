{"mappings":"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","sources":["src/modules/dashboard/listRegistration.ts","node_modules/.pnpm/@xatom+image@1.0.0_@xatom+core@1.0.12/node_modules/@xatom/image/dist/index.js"],"sourcesContent":["// src/pages/listSubscriptions.ts\n\nimport { WFDynamicList, WFComponent } from \"@xatom/core\";\nimport { WFImage } from \"@xatom/image\";\nimport { apiClient } from \"../../api/apiConfig\";\n\n// Define the shape of the program_details object\ninterface ProgramDetails {\n  name: string;\n  Main_Image: string;\n}\n\n// Define the updated Subscription interface based on the new API response\ninterface Subscription {\n  id: number;\n  status: string; // e.g., 'Deposit Paid'\n  subscription_type: string; // e.g., 'Annual', 'Monthly', 'Pay-Per-Semester'\n  program: number; // numeric program ID\n  workshop: number; // numeric workshop ID (may be 0 if none)\n  next_charge_date: string | null;\n  next_charge_amount: number;\n  stripe_subscription_id: string;\n  user_id: number;\n  contact_id: number;\n  sale_id: number;\n  created_at: number; // Unix timestamp in milliseconds\n  program_details: ProgramDetails;\n}\n\n// Define the structure of the API response\ninterface SubscriptionApiResponse {\n  subscriptions: Subscription[];\n}\n\n// Function to fetch subscriptions from the API\nexport async function fetchSubscriptions(): Promise<Subscription[]> {\n  try {\n    const getSubscriptions = apiClient.get<SubscriptionApiResponse>(\n      \"/subscriptions\"\n    );\n    const response = await getSubscriptions.fetch();\n    return response.subscriptions;\n  } catch (error) {\n    console.error(\"Error fetching subscriptions:\", error);\n    throw error;\n  }\n}\n\n// Function to initialize and render the dynamic subscription list\nexport async function initializeDynamicSubscriptionList(\n  containerSelector: string\n) {\n  // Grab and hide both buttons until we know list state\n  const addBtn = document.getElementById(\"add-registration-button\");\n  const manageBtn = document.getElementById(\"manage-registration-button\");\n  if (addBtn) addBtn.style.display = \"none\";\n  if (manageBtn) manageBtn.style.display = \"none\";\n\n  // Initialize a new instance of WFDynamicList for Subscriptions\n  const list = new WFDynamicList<Subscription>(containerSelector, {\n    rowSelector: \"#listRegistrationCard\",       // Template for each card\n    loaderSelector: \"#listRegistrationloading\", // Loader spinner\n    emptySelector: \"#listRegistrationEmpty\",    // Empty state container\n  });\n\n  // Loader renderer\n  list.loaderRenderer(loaderEl => {\n    loaderEl.setStyle({ display: \"flex\" });\n    return loaderEl;\n  });\n\n  // Empty state renderer\n  list.emptyRenderer(emptyEl => {\n    emptyEl.setStyle({ display: \"flex\" });\n    return emptyEl;\n  });\n\n  // Card renderer\n  list.rowRenderer(({ rowData, rowElement }) => {\n    const card = new WFComponent(rowElement);\n\n    // 1) Program image\n    const imgComp = card.getChildAsComponent<HTMLImageElement>(\n      \"#cardRegistrationImage\"\n    );\n    if (imgComp) {\n      const img = new WFImage(imgComp.getElement());\n      img.setImage(\n        rowData.program_details.Main_Image ||\n          \"https://cdn.prod.website-files.com/66102236c16b61185de61fe3/66102236c16b61185de6204e_placeholder.svg\"\n      );\n    }\n\n    // 2) Program name\n    card\n      .getChildAsComponent<HTMLDivElement>(\"#cardProgramName\")\n      ?.setText(rowData.program_details.name);\n\n    // 3) Update card href with program & subscription params\n    const anchor = card.getElement() as HTMLAnchorElement;\n    const url = new URL(anchor.getAttribute(\"href\") || \"#\", window.location.origin);\n    url.searchParams.set(\"program\", String(rowData.program));\n    url.searchParams.set(\"subscription\", String(rowData.id));\n    anchor.setAttribute(\"href\", url.toString());\n\n    // 4) Show the card\n    rowElement.setStyle({ display: \"block\" });\n    return rowElement;\n  });\n\n  // Load and render data\n  list.changeLoadingStatus(true);\n  try {\n    const subs = await fetchSubscriptions();\n\n    // Dedupe: one subscription per program\n    const uniqueByProgram = Array.from(\n      subs.reduce<Map<number, Subscription>>((map, sub) => {\n        if (!map.has(sub.program)) map.set(sub.program, sub);\n        return map;\n      }, new Map()).values()\n    );\n\n    // Sort alphabetically by program name\n    uniqueByProgram.sort((a, b) =>\n      a.program_details.name.localeCompare(b.program_details.name)\n    );\n\n    // Render into the list\n    list.setData(uniqueByProgram);\n\n    // Toggle buttons based on list length\n    if (uniqueByProgram.length === 0) {\n      if (addBtn) addBtn.style.display = \"block\";\n      if (manageBtn) manageBtn.style.display = \"none\";\n    } else {\n      if (addBtn) addBtn.style.display = \"none\";\n      if (manageBtn) manageBtn.style.display = \"block\";\n    }\n  } catch (error) {\n    console.error(\"Error loading subscriptions:\", error);\n    list.setData([]);\n\n    // On error, treat as empty list\n    if (addBtn) addBtn.style.display = \"block\";\n    if (manageBtn) manageBtn.style.display = \"none\";\n  } finally {\n    list.changeLoadingStatus(false);\n  }\n}\n","var t=require(\"@xatom/core\");var e,r,s,i,o,n,u={};e=u,r=\"WFImage\",s=()=>c,Object.defineProperty(e,r,{get:s,set:i,enumerable:!0,configurable:!0});class c extends t.WFComponent{constructor(t){super(t)}getImageConfig(){return this._config}getSrc(){return this.getAttribute(\"src\")}getSizes(){return this.getAttribute(\"sizes\")}getSrcSet(){return this.getAttribute(\"srcset\")}getLoading(){return this.getAttribute(\"loading\")}onLoad(t){return this.on(\"load\",t),()=>{this.off(\"load\",t)}}onLoadError(t){return this.on(\"error\",t),()=>{this.off(\"error\",t)}}setImage(t){if(\"string\"==typeof t)this.setAttribute(\"src\",t),this.removeAttribute(\"srcset\"),this.removeAttribute(\"sizes\");else{if(this.setAttribute(\"src\",t.src),\"object\"==typeof t&&t.srcSet&&t.srcSet.length&&t.sizes&&t.sizes.length){const e=t.srcSet.map((t=>`${t.url} ${t.size}`)).join(\", \");this.setAttribute(\"srcset\",e)}else this.removeAttribute(\"srcset\"),this.removeAttribute(\"sizes\");t.loading&&this.setAttribute(\"loading\",t.loading)}}}o=module.exports,n=u,Object.keys(n).forEach((function(t){\"default\"===t||\"__esModule\"===t||o.hasOwnProperty(t)||Object.defineProperty(o,t,{enumerable:!0,get:function(){return n[t]}})}));"],"names":[],"version":3,"file":"listRegistration.a407700a.js.map","sourceRoot":"../"}